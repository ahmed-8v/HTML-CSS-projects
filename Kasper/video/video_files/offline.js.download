(function(g){var window=this;'use strict';var HMr=function(B){var A=new g.wD("und",new g.Rn("Default","und",!0));A.captionTracks=B.captionTracks;return A},ux7=function(B){return new g.kM(function(A,x){var w=B.length,c=[];
if(w)for(var V=function(n,r){w--;c[n]=r;w==0&&A(c)},Z=function(n){x(n)},R,Y=0;Y<B.length;Y++)R=B[Y],g.B4_(R,g.Ge(V,Y),Z);
else A(c)})},FL=function(B){this.N=B},gh=function(){FL.apply(this,arguments)},eLh=function(){gh.apply(this,arguments)},OMY=function(){gh.apply(this,arguments)},aGh=function(){gh.apply(this,arguments)},F0W=function(){gh.apply(this,arguments)},gGo=function(){gh.apply(this,arguments)},MSW=function(){gh.apply(this,arguments)},lGr=function(){FL.apply(this,arguments)},T$4=function(){gh.apply(this,arguments)},mlj=function(){gh.apply(this,arguments)},L0o=function(){gh.apply(this,arguments)},tSc=function(){gh.apply(this,
arguments)},bMo=function(){gh.apply(this,arguments)},oGr=function(){gh.apply(this,arguments)},J07=function(){gh.apply(this,arguments)},vG0=function(){gh.apply(this,arguments)},X1j=function(){gh.apply(this,arguments)},zL_=function(){gh.apply(this,arguments)},iMV=function(){gh.apply(this,arguments)},GR7=function(){gh.apply(this,arguments)},swj=function(){FL.apply(this,arguments)},Dl0=function(){gh.apply(this,arguments)},BHh=function(){gh.apply(this,arguments)},AZ_=function(){gh.apply(this,arguments)},
xao=function(){gh.apply(this,arguments)},wqV=function(){gh.apply(this,arguments)},cZ8=function(){gh.apply(this,arguments)},Vs7=function(){gh.apply(this,arguments)},Znj=function(){gh.apply(this,arguments)},SAh=function(){gh.apply(this,arguments)},ROh=function(){FL.apply(this,arguments)},YAh=function(){FL.apply(this,arguments)},nI0=function(){FL.apply(this,arguments)},rZh=function(){gh.apply(this,arguments)},dar=function(){gh.apply(this,arguments)},qAr=function(){gh.apply(this,arguments)},fmV=function(){gh.apply(this,
arguments)},hOr=function(){gh.apply(this,arguments)},Qc4=function(){gh.apply(this,arguments)},Imj=function(){gh.apply(this,arguments)},$ao=function(){gh.apply(this,arguments)},Wgc=function(){gh.apply(this,arguments)},PsW=function(){gh.apply(this,arguments)},Uah=function(){gh.apply(this,arguments)},NH7=function(){gh.apply(this,arguments)},jco=function(){gh.apply(this,arguments)},kSY=function(){gh.apply(this,arguments)},KgV=function(){gh.apply(this,arguments)},Cs7=function(){gh.apply(this,arguments)},
pqr=function(){gh.apply(this,arguments)},EIr=function(){gh.apply(this,arguments)},yZh=function(){gh.apply(this,arguments)},Hno=function(){gh.apply(this,arguments)},un0=function(){gh.apply(this,arguments)},eOo=function(){gh.apply(this,arguments)},Onr=function(){gh.apply(this,arguments)},amo=function(){gh.apply(this,arguments)},Fg4=function(){gh.apply(this,arguments)},gIc=function(){FL.apply(this,arguments)},Ms7=function(){gh.apply(this,arguments)},lm0=function(){gh.apply(this,arguments)},THh=function(){gh.apply(this,
arguments)},ma0=function(){gh.apply(this,arguments)},Lgr=function(){gh.apply(this,arguments)},tsW=function(){gh.apply(this,arguments)},bnc=function(){gh.apply(this,arguments)},oIV=function(){gh.apply(this,arguments)},JZo=function(){gh.apply(this,arguments)},vI4=function(){gh.apply(this,arguments)},Xqc=function(){gh.apply(this,arguments)},zOr=function(){gh.apply(this,arguments)},inr=function(){gh.apply(this,arguments)},GSr=function(){gh.apply(this,arguments)},scY=function(){gh.apply(this,arguments)},
Dao=function(){gh.apply(this,arguments)},Bqo=function(){gh.apply(this,arguments)},A6Y=function(){gh.apply(this,arguments)},xbY=function(){gh.apply(this,arguments)},wXW=function(){gh.apply(this,arguments)},c6_=function(){gh.apply(this,arguments)},VLW=function(){gh.apply(this,arguments)},Z70=function(){gh.apply(this,arguments)},SWh=function(){gh.apply(this,arguments)},R4j=function(){gh.apply(this,arguments)},YW7=function(){gh.apply(this,arguments)},nB7=function(){gh.apply(this,arguments)},r6r=function(){gh.apply(this,
arguments)},db8=function(){gh.apply(this,arguments)},qW0=function(B){B=B.key||B.id;
if(!B)throw Error("Entity key is missing");return B},fy0=function(){if(Mx)return Mx();
var B={};Mx=g.f8("PersistentEntityStoreDb",{n7:(B.EntityStore={Fg:1},B.EntityAssociationStore={Fg:2},B),shared:!1,upgrade:function(A,x){x(1)&&g.iP(g.bP(A,"EntityStore",{keyPath:"key"}),"entityType","entityType");x(2)&&(A=g.bP(A,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.iP(A,"byParentEntityKey","parentEntityKey"),g.iP(A,"byChildEntityKey","childEntityKey"))},
version:3});return Mx()},h4Y=function(B){return g.ch(fy0(),B)},Qbr=function(B){return g.ch((0,g.Yzj)(),B)},lo=function(B){this.token=B},TI=function(B,A){A=A===void 0?{}:A;
g.Sr.call(this,g.nko[B],Object.assign({},{name:"PESEncoderError",type:B},A));this.type=B;this.level="WARNING";Object.setPrototypeOf(this,TI.prototype)},Iyr=function(B){return new TI("WRONG_DATA_TYPE",{by:B})},$b_=function(B){return B instanceof Error?new TI("UNKNOWN_ENCODE_ERROR",{qk:B.message}):new TI("UNKNOWN_ENCODE_ERROR")},Wkr=function(B){return B instanceof Error?new TI("UNKNOWN_DECODE_ERROR",{qk:B.message}):new TI("UNKNOWN_DECODE_ERROR")},PLo=function(B,A){B=B instanceof TI?B:A(B);
g.JU(B);throw B;},Ub8=function(){},Nq7=function(B,A,x){try{return B.S(A,x)}catch(w){PLo(w,$b_)}},jbc=function(B){B=(new TextEncoder).encode(B).subarray(0,16);
var A=new Uint8Array(16);A.set(B);return A},mj=function(B){this.N=B},Kko=function(B){var A=k1o[B];
if(A)return A;g.vH(new g.Sr("Entity model not found.",{entityType:B}))},CLj=function(B,A){this.N=B;
this.U=A;this.S={}},EB7=function(B,A){a:{B=pXo(B.U,A.version);
try{var x=B.U(A.data,A.key);break a}catch(w){PLo(w,Wkr)}x=void 0}return x},Lu=function(B,A,x){return B.N.objectStore("EntityStore").get(A).then(function(w){if(w){if(x&&w.entityType!==x)throw Error("Incorrect entity type");
return EB7(B,w)}})},tT=function(B,A,x){return x?(x=x.map(function(w){return Lu(B,w,A)}),g.M5.all(x)):B.N.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(A)).then(function(w){return w.map(function(c){return EB7(B,c)})})},oO=function(B,A,x){var w=qW0(A),c=pXo(B.U,1),V=Object.assign({},A);
return B.N.objectStore("EntityStore").get(w).then(function(Z){if(Z){if(Z.entityType!==x)throw Error("Incorrect entity type");V.entityMetadata||(Z=EB7(B,Z),V.entityMetadata=Z.entityMetadata)}}).then(function(){var Z={key:w,
entityType:x,data:Nq7(c,V,w),version:1};return g.M5.all([g.vR(B.N.objectStore("EntityStore"),Z),y6_(B,V,x)])}).then(function(){bo(B,w,x);
return w})},H7Y=function(B,A,x){A=A.map(function(w){return oO(B,w,x)});
return g.M5.all(A)},JT=function(B,A,x){if(x==null?0:x.wi){var w=new Set;
return u_r(B,A,w).then(function(){for(var V=[],Z=g.W(w),R=Z.next();!R.done;R=Z.next())V.push(JT(B,R.value));return g.M5.all(V).then(function(){})})}var c=g.IY(A).entityType;
return g.M5.all([B.N.objectStore("EntityStore").delete(A),e4r(B,A)]).then(function(){bo(B,A,c)})},O7h=function(B,A){return g.Bh(B.N.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(A)},function(x){return g.M5.all([x.delete(),
e4r(B,x.cursor.primaryKey)]).then(function(){bo(B,x.cursor.primaryKey,A);return g.sl(x)})})},ay_=function(B,A,x,w){var c=pXo(B.U,1);
return Lu(B,A,w).then(function(V){if(V){V=g.p1(V,x);var Z={key:A,entityType:w,data:Nq7(c,V,A),version:1};return g.M5.all([g.vR(B.N.objectStore("EntityStore"),Z),y6_(B,V,w)])}}).then(function(){bo(B,A,w);
return A})},bo=function(B,A,x){var w=B.S[x];
w||(w=new Set,B.S[x]=w);w.add(A)},FkY=function(B,A,x){var w=qW0(A);
x=Kko(x);if(!x)return g.M5.resolve([]);x=new x(A);B=B.N.objectStore("EntityAssociationStore");A=[];x=g.W(x.U());for(var c=x.next();!c.done;c=x.next())A.push(g.vR(B,{parentEntityKey:w,childEntityKey:c.value}));return g.M5.all(A).then(function(V){return V.map(function(Z){return Z[1]})})},e4r=function(B,A){return B.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(A))},y6_=function(B,A,x){var w=qW0(A);
return e4r(B,w).then(function(){return FkY(B,A,x)})},u_r=function(B,A,x){if(x.has(A))return g.M5.resolve(void 0);
x.add(A);return gBo(B,A).then(function(w){return B.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(A)).then(function(){return w})}).then(function(w){var c=g.M5.resolve(void 0);
w=g.W(w);for(var V=w.next(),Z={};!V.done;Z={xE:void 0},V=w.next())Z.xE=V.value,c=c.then(function(R){return function(){return u_r(B,R.xE,x)}}(Z));
return c}).then(function(){})},gBo=function(B,A){var x=B.N.objectStore("EntityAssociationStore");
return x.index("byParentEntityKey").getAll(IDBKeyRange.only(A)).then(function(w){var c=[];w=g.W(w);for(var V=w.next();!V.done;V=w.next())V=V.value,c.push(x.index("byChildEntityKey").getAll(V.childEntityKey));return g.M5.all(c)}).then(function(w){var c=[];
w=g.W(w);for(var V=w.next();!V.done;V=w.next())V=V.value,V.length===1&&c.push(V[0].childEntityKey);return c})},vx=function(){},ML4=function(){this.N={};
this.N[0]=new vx;if(!g.a3("aes_pes_encoder_killswitch")){var B=this.N;try{var A=g.RI();var x=jbc(A);var w=new mj(new g.OQ(x),new g.eG(x))}catch(c){throw B=c instanceof Error?new TI("KEY_CREATION_FAILED",{qk:c.message}):new TI("KEY_CREATION_FAILED"),g.JU(B),B;}B[1]=w}},pXo=function(B,A){A=A===void 0?0:A;
B=B.N[A];if(!B)throw A=new TI("INVALID_ENCODER_VERSION",{by:A}),g.JU(A),A;return B},XL=function(B,A){g.l.call(this);
this.token=B;this.N=A;this.observers=[];B=new g.lg.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.RI());B.onmessage=this.U.bind(this);this.channel=B},zI=function(B,A,x){var w,c,V,Z;
return g.u(function(R){if(R.N==1)return g.y(R,h4Y(B.token),2);if(R.N!=3)return w=R.U,g.y(R,g.Jz(w,["EntityStore","EntityAssociationStore"],A,function(Y){c=new CLj(Y,B.N);return x(c)}),3);
V=R.U;c&&(Z=c.S,Object.keys(Z).length>0&&(B.channel.postMessage(Z),lyc(B,Z)));return R.return(V)})},io=function(B,A,x){return zI(B,{mode:"readwrite",
Yb:!0},function(w){return oO(w,A,x)})},Tq_=function(B,A){return zI(B,{mode:"readwrite",
Yb:!0},function(x){return H7Y(x,A,"offlineOrchestrationActionWrapperEntity")})},mbW=function(B,A){return zI(B,{mode:"readwrite",
Yb:!0},function(x){return JT(x,A)})},Lk7=function(B){return zI(B,{mode:"readwrite",
Yb:!0},function(A){return O7h(A,"videoPlaybackPositionEntity")})},GI=function(B,A,x){return zI(B,{mode:"readonly",
Yb:!0},function(w){return Lu(w,A,x)})},sc=function(B,A,x){return zI(B,{mode:"readonly",
Yb:!0},function(w){return tT(w,A,x)})},lyc=function(B,A){B=g.W(B.observers);
for(var x=B.next();!x.done;x=B.next())x=x.value,x(A)},tLV=function(){var B,A,x;
return g.u(function(w){if(w.N==1)return g.Pp(w,2),g.y(w,g.dF(),4);if(w.N!=2){B=w.U;if(!B||!g.Yr()||typeof g.lg.BroadcastChannel==="undefined")return w.return();A=new ML4;return w.return(new XL(B,A))}x=g.j_(w);x instanceof Error&&g.JU(x);return w.return()})},DQ=function(){b7j||(b7j=tLV());
return b7j},oBo=function(B){var A;
B=(A=B.options)==null?void 0:A.persistenceOption;return B==="ENTITY_PERSISTENCE_OPTION_PERSIST"||B==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},J6o=function(B){var A;
return g.u(function(x){return x.N==1?g.y(x,DQ(),2):(A=x.U)?g.y(x,zI(A,"readwrite",function(w){for(var c={},V=g.W(B),Z=V.next(),R={};!Z.done;R={jj:void 0,Kb:void 0},Z=V.next())R.jj=Z.value,R.jj.entityKey&&oBo(R.jj)&&(R.Kb=g.p4(R.jj.payload),Z=void 0,R.jj.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(Z=function(Y){return function(){return oO(w,Y.jj.payload[Y.Kb],Y.Kb)}}(R)),R.jj.type==="ENTITY_MUTATION_TYPE_DELETE"&&(Z=function(Y){return function(){return JT(w,Y.jj.entityKey)}}(R)),R.jj.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(Z=function(Y){return function(){return ay_(w,Y.jj.entityKey,Y.jj.payload[Y.Kb],Y.Kb)}}(R)),Z&&(c[R.jj.entityKey]=c[R.jj.entityKey]?c[R.jj.entityKey].then(Z):Z()));
return g.M5.all(Object.values(c))}),0):x.return()})},vBc=function(B){var A;
return g.u(function(x){if(x.N==1){A=B.mutations;if(!A||A.length<=0)return x.return();if(g.AH){var w={type:"ENTITY_LOADED"};A!==void 0&&(w.payload=A);g.AH.dispatch(w)}return g.y(x,J6o(A),2)}A.length=0;g.Wp(x)})},XXh=function(B){return B!==void 0},z4r=function(B){var A=g.EH();
A=Object.assign({},A);B=Object.assign({},B);for(var x in A)B[x]?(A[x]!==4&&(A[x]=B[x]),delete B[x]):A[x]!==2&&(A[x]=4);Object.assign(A,B);g.X6t(A);JSON.stringify(A);return A},i77=function(B){var A,x;
return g.u(function(w){if(w.N==1)return g.y(w,g.dF(),2);if(w.N!=3)return(A=w.U)?g.y(w,g.uE(A),3):w.return();x=w.U;return w.return(g.Jz(x,["index","media","captions"],{mode:"readwrite",Yb:!0},function(c){var V=IDBKeyRange.bound(B+"|",B+"~");c=[c.objectStore("index").delete(V),c.objectStore("media").delete(V),c.objectStore("captions").delete(V)];return g.M5.all(c).then(function(){})}))})},G18=function(){var B,A;
return g.u(function(x){if(x.N==1)return g.y(x,g.dF(),2);if(x.N!=3){B=x.U;if(!B)throw g.Fs("rvdfd");return g.y(x,g.uE(B),3)}A=x.U;return x.return(g.Jz(A,["index","media"],{mode:"readwrite",Yb:!0},function(w){var c={};return g.Gc(w.objectStore("index"),{},function(V){var Z=V.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),R=g.M5.resolve(void 0);if(Z){var Y=Z[1];Z=Z[2];c[Y]=c[Y]||{};var n;c[Y][Z]=g.DKa((n=V.getValue())==null?void 0:n.fmts)}else R=V.delete().then(function(){});
return g.M5.all([g.sl(V),R]).then(function(r){return g.W(r).next().value})}).then(function(){for(var V={},Z=g.W(Object.keys(c)),R=Z.next();!R.done;R=Z.next()){R=R.value;
var Y=c[R].v;V[R]=c[R].a&&Y?1:2}var n=z4r(V);return g.e5v(w.objectStore("media"),{},function(r){var d=r.cursor.key.match(g.wL_);d&&V[d[1]]||w.objectStore("media").delete(r.cursor.key);return g.jht(r)}).then(function(){return n})})}))})},sbo=function(B,A){var x,w;
return g.u(function(c){if(c.N==1)return g.y(c,g.dF(),2);if(c.N!=3){x=c.U;if(!x)throw g.Fs("wct");return g.y(c,g.uE(x),3)}w=c.U;return g.y(c,g.Jz(w,["captions"],{mode:"readwrite",Yb:!0},function(V){var Z=[];V=V.objectStore("captions");for(var R=0;R<A.length;R++){var Y=g.vR(V,A[R],B+"|"+A[R].metadata.vss_id);Z.push(Y)}return g.M5.all(Z)}),0)})},DbY=function(B){var A,x,w;
return g.u(function(c){if(c.N==1)return A=IDBKeyRange.bound(B+"|",B+"~"),g.y(c,g.dF(),2);if(c.N!=3){x=c.U;if(!x)throw g.Fs("gactfv");return g.y(c,g.uE(x),3)}w=c.U;return c.return(w.getAll("captions",A))})},BBr=function(B){return g.u(function(A){g.HD(B,0);
return A.return(i77(B))})},AV4=function(B){return{context:g.Wj(),
videoIds:B}},xzo=function(B){return{context:g.Wj(),
playlistIds:B}},wGh=function(B){return{context:g.Wj(),
offlinePlaylistSyncChecks:B}},cVo=function(){this.N=new Map},ZVo=function(){VA8||(VA8=new cVo);
return VA8},SJ_=function(B,A){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:B},metadata:A,statusCode:void 0,csn:void 0,can:void 0}},Rv_=function(B,A,x){if(!x){var w=w===void 0?!1:w;
x=B.N.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!x||w)x=g.FP(16),B.N.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",x)}B={flowNonce:x,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:A.eventType};A.metadata&&(B.flowMetadata=A.metadata);A.statusCode!==void 0&&(B.flowEventStatus=A.statusCode);A.csn&&(B.csn=A.csn);A.can&&(B.can=A.can);g.jr("flowEvent",B,void 0)},YJ4=function(B){var A,x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E;
return g.u(function(e){if(e.N==1)return g.y(e,zI(B,{mode:"readonly",Yb:!0},function(F){return tT(F,"playbackData").then(function(x$){var Va=x$.map(function(Qa){return Qa.transfer}).filter(function(Qa){return!!Qa}),Zx=x$.map(function(Qa){return Qa.offlineVideoPolicy}).filter(function(Qa){return!!Qa}),a=x$.filter(function(Qa){return!!Qa.key}).map(function(Qa){return g.$9(g.IY(Qa.key).entityId,"downloadStatusEntity")});
Va=tT(F,"transfer",Va);Zx=tT(F,"offlineVideoPolicy",Zx);a=tT(F,"downloadStatusEntity",a);var rr=Va.then(function(Qa){Qa=Qa.reduce(function(Y$,ug){(ug==null?0:ug.offlineVideoStreams)&&Y$.push.apply(Y$,g.U(ug.offlineVideoStreams));return Y$},[]).filter(function(Y$){return!!Y$});
return tT(F,"offlineVideoStreams",Qa)});
return g.M5.all([Va,Zx,rr,a]).then(function(Qa){var Y$=g.W(Qa);Qa=Y$.next().value;var ug=Y$.next().value;var fr=Y$.next().value;Y$=Y$.next().value;return[x$,Qa,ug,fr,Y$]})})}),2);
if(e.N!=3)return A=e.U,g.y(e,zI(B,{mode:"readonly",Yb:!0},function(F){return tT(F,"mainDownloadsListEntity").then(function(x$){var Va,Zx;return(Zx=(Va=x$[0])==null?void 0:Va.downloads)!=null?Zx:[]})}),3);
x=e.U;w=g.W(A);c=w.next().value;V=w.next().value;Z=w.next().value;R=w.next().value;Y=w.next().value;n=c;r=V;d=Z;q=R;f=Y;h={};P={};N={};K={};p={};H=[];O=g.W(r);for(M=O.next();!M.done;M=O.next())(t=M.value)&&(h[t.key]=t);v=g.W(d);for(cp=v.next();!cp.done;cp=v.next())(S_=cp.value)&&(P[S_.key]=S_);Bp=g.W(f);for(L=Bp.next();!L.done;L=Bp.next())(z=L.value)&&(N[z.key]=z);I=g.W(q);for(b=I.next();!b.done;b=I.next())(Dx=b.value)&&(K[Dx.key]=Dx);Nj=g.W(x);for(Ao=Nj.next();!Ao.done;Ao=Nj.next())pD=Ao.value,ig=
void 0,p[(ig=pD.videoItem)!=null?ig:""]=!0,pD.videoItem&&(I7=wo=void 0,k=(I7=(wo=g.IY(pD.videoItem))==null?void 0:wo.entityId)!=null?I7:"",H.push({externalVideoId:k}));C=n.filter(function(F){if(!F||!F.key||!F.offlineVideoPolicy)return!1;F=g.IY(F.key).entityId;F=g.$9(F,"downloadStatusEntity");var x$;return!(F&&((x$=N[F])==null?void 0:x$.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
E=C.map(function(F){var x$=h[F.transfer],Va=[];if(x$==null?0:x$.offlineVideoStreams)for(var Zx=g.W(x$.offlineVideoStreams),a=Zx.next();!a.done;a=Zx.next())(a=K[a.value])&&Va.push(a);Zx=P[F.offlineVideoPolicy];a=p;var rr=F==null?void 0:F.playerResponseTimestamp,Qa=g.IY(Zx.key).entityId;F=g.$9(Qa,"mainVideoEntity");if(Zx.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Y$="OFFLINE_VIDEO_STATE_DISABLED";Zx.expirationTimestamp&&Number(Zx.expirationTimestamp)<Date.now()/1E3&&(Y$="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Zx.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Y$="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(x$==null?void 0:x$.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Y$="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Y$="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Y$="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Y$="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Y$="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Y$="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Y$="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Y$==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(x$==null?void 0:x$.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Y$="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Y$="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Y$=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Qa={id:Qa,videoState:Y$};if(x$==null?0:x$.cotn)Qa.cotn=x$.cotn;if(x$==null?0:x$.maximumDownloadQuality)Qa.selectedVideoQuality=x$==null?void 0:x$.maximumDownloadQuality;if(x$==null?0:x$.lastProgressTimeMs)Qa.lastProgressTimeMs=x$.lastProgressTimeMs;rr&&(Qa.playerResponseSavedTimeMs=String(Number(rr)*1E3));x$=String;rr=0;Va=g.W(Va);for(Y$=Va.next();!Y$.done;Y$=Va.next())if(Y$=Y$.value,Y$.streamsProgress){Y$=g.W(Y$.streamsProgress);for(var ug=Y$.next();!ug.done;ug=
Y$.next()){var fr=void 0;rr+=Number((fr=ug.value.numBytesDownloaded)!=null?fr:0)}}Qa.downloadedBytes=x$(rr);Qa.selectedOfflineMode=a[F]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Zx.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Qa.offlinePlaybackDisabledReason=Zx.offlinePlaybackDisabledReason);return Qa});
return e.return({offlineVideos:E,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:H}}})})},nX7=function(){this.locks=navigator.locks},rVr=function(){try{var B=g.mv("ytglobal.locks_");
if(B)return B;var A;if(A=navigator){var x=navigator;A="locks"in x&&!!x.locks}if(A)return g.lg.localStorage&&g.lg.localStorage.getItem("noop"),B=new nX7,g.Te("ytglobal.locks_",B),B}catch(w){}},BV=function(){},dzo=function(){},qJc=function(B){if(B.includes(":"))throw Error("Invalid user cache name: "+B);
return B+":"+g.RI("CacheStorage get")},fIr=function(){return g.u(function(B){if(A_!==void 0)return B.return(A_);
A_=new Promise(function(A){var x;return g.u(function(w){switch(w.N){case 1:return g.Pp(w,2),g.y(w,xf.open("test-only"),4);case 4:return g.y(w,xf.delete("test-only"),5);case 5:g.Nc(w,3);break;case 2:if(x=g.j_(w),x instanceof Error&&x.name==="SecurityError")return A(!1),w.return();case 3:A("caches"in window),g.Wp(w)}})});
return B.return(A_)})},Q4o=function(){return g.u(function(B){if(B.N==1)return g.y(B,fIr(),2);
if(!B.U)return B.return(void 0);hvo||(hvo=new dzo);return B.return(hvo)})},w7=function(B,A,x){g.vH(new g.Sr("Woffle: "+B,x?{cotn:x}:""));
A instanceof Error&&g.vH(A)},II4=function(B){var A;
return g.u(function(x){if(x.N==1)return g.y(x,YJ4(B),2);A=x.U;g.jr("offlineStateSnapshot",A);g.Wp(x)})},cV=function(B){g.l.call(this);
var A=this;this.api=B;this.v3={yIv:function(){return A.N},
JIM:function(){return A.U}};
typeof g.lg.BroadcastChannel!=="undefined"&&(this.N=new g.lg.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.RI()),this.N.onmessage=this.S.bind(this),this.U=new g.lg.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.RI()),this.U.onmessage=this.D.bind(this))},V$=function(B,A){B.api.m7("onOfflineOperationFailure",A);
var x;(x=B.N)==null||x.postMessage(A)},$zc=function(B,A,x,w){var c=this;
this.j=B;this.Z=A;this.visibility=x;this.B=w;this.K=this.T=this.Y=this.S=this.N=!1;this.D=new g.dN(function(){c.Id()});
this.v3={KP:function(){return c.U},
Id:function(){c.Id()},
kNP:function(){return c.D}};
this.visibility.subscribe("visibilitystatechange",function(){c.rP()})},Wlr=function(B){if(!B.S&&!B.N){var A=rVr();
if(A){B.S=!0;var x=g.RI("OfflineLockManager");A.request("woffle_orchestration_leader:"+x,{},function(){var w,c,V,Z;return g.u(function(R){switch(R.N){case 1:return g.Pp(R,2),B.U=new g.CM,B.N=!0,B.S=!1,g.y(R,B.j(),4);case 4:return g.y(R,B.U.promise,5);case 5:g.Nc(R,0);break;case 2:w=g.j_(R),((V=(c=B).B)==null?0:V.call(c,"wo_relinquish_leadership_on_lock_request_error"))||B.Id(),w instanceof Error&&(Z=w,Z.args=[{name:"WoLockManagerError",Db:w.name}],g.JU(Z)),g.Wp(R)}})})}}},PHY=function(B){B.N&&(B.K=
!0,Z8(B))},UzV=function(B,A){B.N&&(B.Y=A,Z8(B))},NBh=function(B,A){B.N&&(B.T=A,Z8(B))},Z8=function(B){B.T&&B.Y&&B.K&&B.visibility.isBackground()?g.qY(B.D,6E4):B.D.stop()},Sw=function(B){var A;
B.offlineDeleteReason=(A=B.offlineDeleteReason)!=null?A:"OFFLINE_DELETE_REASON_UNKNOWN";var x;B.offlineModeType=(x=B.offlineModeType)!=null?x:"OFFLINE_NOW";g.jr("offlineDeleteEvent",B)},RF=function(B,A){var x=A.videoId;
var w=A.v7;A=A.offlineModeType;B.encryptedVideoId=x;B.cotn=w==null?void 0:w.cotn;B.offlineabilityFormatType=w==null?void 0:w.maximumDownloadQuality;var c;B.isRefresh=(c=w==null?void 0:w.isRefresh)!=null?c:!1;var V;B.softErrorCount=(V=w==null?void 0:w.transferRetryCount)!=null?V:0;B.offlineModeType=A!=null?A:"OFFLINE_NOW";(B.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&B.statusType==="UNKNOWN_STATUS_TYPE"||!B.transferStatusType&&!B.statusType)&&g.vH(Error("Woffle unknown transfer status"));
g.jr("offlineTransferStatusChanged",B)},j4_=function(B,A,x,w){w={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!w};A&&x&&(A=Math.floor(A/1024).toFixed(),x=Math.floor(x/1024).toFixed(),w.alreadyDownloadedKbytes=A,w.totalFetchedKbytes=A,w.totalContentKbytes=x);RF(w,B)},kEo=function(B){RF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},B)},Klo=function(B){switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Yf=function(B){var A,x,w;
return((w=(A=B.actionMetadata)==null?void 0:(x=A.retryScheduleIntervalsInSeconds)==null?void 0:x.length)!=null?w:0)>0},nB=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!B.entityKey},r7=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!B.entityKey},d7=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!B.entityKey},CHh=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!B.entityKey},
qN=function(B,A,x,w,c){c=c===void 0?!1:c;
var V,Z,R,Y,n,r;return g.u(function(d){if(d.N==1)return V=g.$9(B,A),Z=g.$9(B,"downloadStatusEntity"),g.y(d,zI(x,{mode:"readonly",Yb:!0},function(q){return g.M5.all([Lu(q,V,A),Lu(q,Z,"downloadStatusEntity")])}),2);
R=d.U;Y=R.length?R[0]:void 0;if(!Y)return d.t$(0);n=pGh;if(r=R.length>1?R[1]:void 0){if(r.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!c)return d.return();r.downloadState=w}else r={key:Z,downloadState:w};g.sh(Y,n,r);return g.y(d,zI(x,{mode:"readwrite",Yb:!0},function(q){return g.M5.all([oO(q,Y,A),oO(q,r,"downloadStatusEntity")])}),0)})},fB=function(B,A){return B.actionType===A.actionType&&B.entityKey===A.entityKey},h_=function(B,A){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!==
"TRANSFER_STATE_FAILED"){var x=g.IY(B.key).entityId;
RF({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:x,v7:B,offlineModeType:A})}},Q$=function(B){if(!B||!B.thumbnails)return[];
var A=[];B=g.W(B.thumbnails);for(var x=B.next();!x.done;x=B.next())x=x.value,x.url&&A.push(x.url);return A},EXh=function(B,A,x){x=x===void 0?[]:x;
var w,c,V,Z,R,Y,n,r,d,q,f,h,P;return g.u(function(N){if(N.N==1)return x.length?g.y(N,sc(B,A),2):N.return([]);w=N.U;c=new Set;V=g.W(w);for(Z=V.next();!Z.done;Z=V.next())if(R=Z.value,Y=R.id||R.key)n=g.IY(Y).entityId,c.add(n);r=[];d=g.W(x);for(q=d.next();!q.done;q=d.next())f=q.value,h=f.offlineVideoData,P=void 0,((P=h)==null?0:P.videoId)&&!c.has(h.videoId)&&r.push(f);return N.return(r)})},yVr=function(B,A,x){return new g.bE(B,{cotn:A,
raw_player_response:x,download_media:!0,start:Infinity,disable_watch_next:!0})},HVV=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},IF=function(B,A,x,w,c,V,Z,R,Y,n,r){this.entityType=B;
this.actionId=A;this.action=x;this.parentActionId=w;this.rootActionId=c===void 0?A:c;this.childActionIds=V;this.prereqActionId=Z;this.postreqActionIds=R;this.hasChildActionFailed=n;this.retryScheduleIndex=0;this.N=r||Date.now();this.retryScheduleIndex=Y||0},$f=function(B){if(!B.key)throw Error("Entity key is required.");
if(!B.actionProto)throw Error("OfflineOrchestrationAction is required.");var A=g.IY(B.key),x=g.IY(B.actionProto.entityKey);return new IF(x.entityType,A.entityId,B.actionProto,B.parentActionId,B.rootActionId,B.childActionIds,B.prereqActionId,B.postreqActionIds,B.retryScheduleIndex,B.hasChildActionFailed,Number(B.enqueueTimeSec)*1E3)},WV=function(B){return{key:g.$9(B.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:B.action,parentActionId:B.parentActionId,rootActionId:B.rootActionId,childActionIds:B.childActionIds,prereqActionId:B.prereqActionId,postreqActionIds:B.postreqActionIds,retryScheduleIndex:B.retryScheduleIndex,hasChildActionFailed:B.hasChildActionFailed,enqueueTimeSec:(B.N/1E3).toFixed()}},uEr=function(){var B;
return g.u(function(A){return A.N==1?g.y(A,Q4o(),2):(B=A.U)?A.return(B.delete("yt-player-local-img")):A.return(!0)})},PV=function(B){var A,x;
return g.u(function(w){if(w.N==1)return g.y(w,Q4o(),2);if(w.N!=3){A=w.U;if(!A)throw Error("Cache API not supported");return B.length?g.y(w,A.open("yt-player-local-img"),3):w.return()}x=w.U;return g.y(w,Promise.all(B.map(function(c){return x.delete(c)})),0)})},UR=function(B){var A,x;
return g.u(function(w){if(w.N==1)return g.y(w,Q4o(),2);if(w.N!=3){A=w.U;if(!A)throw Error("Cache API not supported");return B.length?g.y(w,A.open("yt-player-local-img"),3):w.return()}x=w.U;return g.y(w,x.addAll(B),0)})},NN=function(B,A,x,w,c){var V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig;
return g.u(function(wo){switch(wo.N){case 1:return V=g.$9(B,"mainVideoEntity"),Z=g.$9(B,"ytMainChannelEntity"),R=g.$9(B,"transfer"),Y=g.$9(B,"videoDownloadContextEntity"),g.y(wo,zI(A,{mode:"readonly",Yb:!0},function(I7){return g.M5.all([Lu(I7,V,"mainVideoEntity"),Lu(I7,Z,"ytMainChannelEntity"),Lu(I7,R,"transfer"),Lu(I7,Y,"videoDownloadContextEntity"),tT(I7,"ytMainChannelEntity"),tT(I7,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:n=wo.U;r=g.W(n);d=r.next().value;q=r.next().value;f=r.next().value;h=r.next().value;P=r.next().value;N=r.next().value;K=d;p=q;H=f;O=h;M=P;t=N;if(!K&&!p){wo.t$(3);break}v=K?Q$(K.thumbnail):[];if(!p){cp=[];wo.t$(4);break}return g.y(wo,evr(p,M),5);case 5:cp=wo.U;case 4:return S_=cp,g.y(wo,PV(v.concat(S_)),3);case 3:Bp=[];L=g.$9(B,"downloadStatusEntity");z=g.W(t);for(I=z.next();!I.done;I=z.next())b=I.value,Dx=g.IY(b.key).entityId,Nj=$f(b),Ao=g.IY(Nj.action.entityKey).entityId,Dx!==B&&Ao!==B||fB(x,
b.actionProto)||Bp.push(b.key);return g.y(wo,zI(A,{mode:"readwrite",Yb:!0},function(I7){var k=Bp.map(function(C){return JT(I7,C)});
k.push(JT(I7,V,{wi:!0}));k.push(JT(I7,L,{wi:!0}));return g.M5.all(k)}),7);
case 7:ig=(pD=O)==null?void 0:pD.offlineModeType,c&&(Sw(c),c.offlineModeType&&(ig=c.offlineModeType)),h_(H,ig),V$(w,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wp(wo)}})},FlV=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E,e,F,x$,Va,Zx,a,rr,Qa,Y$,ug,fr,Lr,fa;
return g.u(function(ov){switch(ov.N){case 1:return c=g.$9(B,"mainPlaylistEntity"),V=g.$9(B,"ytMainChannelEntity"),g.y(ov,zI(A,{mode:"readonly",Yb:!0},function(T2){return g.M5.all([Lu(T2,c,"mainPlaylistEntity"),Lu(T2,V,"ytMainChannelEntity"),tT(T2,"mainPlaylistEntity"),tT(T2,"mainDownloadsListEntity"),tT(T2,"ytMainChannelEntity"),tT(T2,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=ov.U;R=g.W(Z);Y=R.next().value;n=R.next().value;r=R.next().value;d=R.next().value;q=R.next().value;f=R.next().value;h=Y;P=n;N=r;K=d;p=q;H=f;if(!h&&!P){ov.t$(3);break}O=h?OVV(h):[];if(!P){M=[];ov.t$(4);break}return g.y(ov,evr(P,p),5);case 5:M=ov.U;case 4:return t=M,g.y(ov,PV(O.concat(t)),3);case 3:v=[];cp=new Map;if(!h){ov.t$(7);break}return g.y(ov,aI_(h,N,K),8);case 8:v=ov.U;S_=g.W(v);for(Bp=S_.next();!Bp.done;Bp=S_.next())L=Bp.value,cp.set(L,{videoId:L,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.y(ov,zI(A,{mode:"readonly",Yb:!0},function(T2){return g.M5.all([tT(T2,"transfer"),tT(T2,"videoDownloadContextEntity")])}),9);
case 9:z=ov.U;I=g.W(z);b=I.next().value;Dx=I.next().value;Nj=b;Ao=Dx;pD=g.W(Nj);for(ig=pD.next();!ig.done;ig=pD.next())wo=ig.value,I7=g.IY(wo.key).entityId,(k=cp.get(I7))&&wo&&(k.cotn=wo.cotn);C=g.W(Ao);for(E=C.next();!E.done;E=C.next())e=E.value,F=g.IY(e.key).entityId,(x$=cp.get(F))&&e&&(x$.offlineModeType=e.offlineModeType);case 7:Va=[];Zx=g.W(H);for(a=Zx.next();!a.done;a=Zx.next())rr=a.value,Qa=g.IY(rr.key).entityId,Y$=$f(rr),Qa!==B&&Y$.rootActionId!==B||fB(x,rr.actionProto)||Va.push(rr.key);ug=
g.$9(B,"mainPlaylistEntity");return g.y(ov,zI(A,{mode:"readwrite",Yb:!0},function(T2){var nR=Va.map(function(eF){return JT(T2,eF)});
nR.push(JT(T2,ug,{wi:!0}));return g.M5.all(nR)}),10);
case 10:if(!h){ov.t$(0);break}v.reverse();if(!v){ov.t$(0);break}fr=g.W(v);Lr=fr.next();case 13:if(Lr.done){ov.t$(0);break}fa=Lr.value;return g.y(ov,NN(fa,A,x,w,cp.get(fa)),14);case 14:Lr=fr.next(),ov.t$(13)}})},MAW=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q;
return g.u(function(f){if(f.N==1)return c=g.$9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),V=new Map,g.y(f,zI(B,{mode:"readwrite",Yb:!0},function(h){var P=tT(h,"transfer"),N=tT(h,"offlineOrchestrationActionWrapperEntity"),K=tT(h,"videoDownloadContextEntity"),p=Lu(h,c,"mainDownloadsListEntity");return g.M5.all([P,N,K,p]).then(function(H){H=g.W(H);var O=H.next().value;var M=H.next().value;var t=H.next().value;var v=H.next().value;H=gX0.map(function(S_){return O7h(h,S_)});
M=g.W(M);for(var cp=M.next();!cp.done;cp=M.next())cp=cp.value,fB(A,cp.actionProto)||H.push(JT(h,cp.key,{wi:!0}));v&&(v.downloads=[],H.push(oO(h,v,"mainDownloadsListEntity")));if(t)for(t=g.W(t),v=t.next();!v.done;v=t.next())v=v.value,M=g.IY(v.key).entityId,M=g.$9(M,"transfer"),V.set(M,v.offlineModeType);return g.M5.all(H).then(function(){return O})})}),2);
Z=f.U;R=g.W(Z);for(Y=R.next();!Y.done;Y=R.next())n=Y.value,h_(n,V.get(n.key)),r=g.IY(n.key).entityId,d={videoId:r,offlineDeleteReason:w,cotn:n.cotn,offlineModeType:V.get(n.key)},Sw(d),q=g.$9(r,"mainVideoEntity"),V$(x,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(f,uEr(),0)})},OVV=function(B,A){var x=[];
if(B.thumbnailStyleData){B=g.W(B.thumbnailStyleData);for(var w=B.next();!w.done;w=B.next()){var c=void 0,V=void 0,Z=void 0;x=x.concat(Q$((c=w.value)==null?void 0:(V=c.value)==null?void 0:(Z=V.collageThumbnail)==null?void 0:Z.coverThumbnail))}}A=Q$(A);return x.concat(A)},aI_=function(B,A,x){var w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_;
return g.u(function(Bp){w=[];c=new Set;if(x.length)for(V=g.W(x),Z=V.next();!Z.done;Z=V.next())if(R=Z.value,Y=void 0,(Y=R.downloads)==null?0:Y.length)for(n=g.W(R.downloads),r=n.next();!r.done;r=n.next())d=r.value,d.videoItem&&(q=g.IY(d.videoItem).entityId,c.add(q));if(B.videos){f=g.W(B.videos);for(h=f.next();!h.done;h=f.next())P=h.value,N=JSON.parse(g.IY(P).entityId),N.videoId&&!c.has(N.videoId)&&w.push(N.videoId);K=g.W(A);for(p=K.next();!p.done;p=K.next())if(H=p.value,H.key!==B.key&&(O=H.videos))for(M=
g.W(O),t=M.next();!t.done;t=M.next())v=t.value,cp=JSON.parse(g.IY(v).entityId),cp.videoId&&(S_=w.indexOf(cp.videoId),S_!==-1&&w.splice(S_,1))}return Bp.return(w)})},evr=function(B,A){var x,w,c,V,Z,R,Y,n;
return g.u(function(r){x=Q$(B.avatar);w=g.W(A);for(c=w.next();!c.done;c=w.next())if(V=c.value,V.id!==B.id)for(Z=g.W(Q$(V.avatar)),R=Z.next();!R.done;R=Z.next())Y=R.value,n=x.indexOf(Y),n!==-1&&x.splice(n,1);return r.return(x)})},lI4=function(B){var A;
return g.u(function(x){A=g.m(B.frameworkUpdates,jw);return B.frameworkUpdates&&A?g.y(x,vBc(A),0):x.return()})},mz4=function(B){var A;
if((A=B.onResponseReceivedActions)!=null&&A.length){var x;B=(x=g.m(g.m(B.onResponseReceivedActions[0],TBV),g.Vi4))==null?void 0:x.actions;if(B!=null&&B.length)return B}},Llc=function(B){var A,x,w;
return g.u(function(c){if(c.N==1)return B?g.y(c,GI(B,g.OU,"mainDownloadsListEntity"),2):c.return([]);A=c.U;return((x=A)==null?0:(w=x.downloads)==null?0:w.length)?c.return(A.downloads.map(function(V){var Z;return(Z=V.videoItem)!=null?Z:""})):c.return([])})},bVj=function(B,A){var x;
return g.u(function(w){return w.N==1?g.y(w,tA7(B,A),2):(x=w.U)?g.y(w,zI(B,{mode:"readwrite",Yb:!0},function(c){var V=[oO(c,x.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];x.mainDownloadsListEntity&&V.push(oO(c,x.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.M5.all(V)}),0):w.t$(0)})},tA7=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H;
return g.u(function(O){if(O.N==1)return x=g.$9("main_downloads_library_id","mainDownloadsLibraryEntity"),w=g.$9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(O,zI(B,{mode:"readonly",Yb:!0},function(M){return g.M5.all([Lu(M,x,"mainDownloadsLibraryEntity"),Lu(M,w,"mainDownloadsListEntity")])}),2);
c=O.U;V=g.W(c);Z=V.next().value;R=V.next().value;Y=Z;n=R;Y||(Y={id:x});r=g.W(A);for(d=r.next();!d.done;d=r.next())if(q=d.value,q===g.OU){if(Y.smartDownloadsList)return O.return();Y.smartDownloadsList=q}else if(f=g.IY(q).entityType,h={},f==="mainPlaylistEntity"?h.playlistItem=q:f==="mainVideoEntity"&&(h.videoItem=q),!g.OC(h)){P=void 0;if((P=n)==null?0:P.downloads){N=!1;K=g.W(n.downloads);for(p=K.next();!p.done;p=K.next())if(H=p.value,H.playlistItem===q||H.videoItem===q){N=!0;break}N||n.downloads.push(h)}else n=
{id:w,downloads:[h]};Y.downloadsList=w}return O.return({mainDownloadsLibraryEntity:Y,mainDownloadsListEntity:n})})},oXh=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N;
return g.u(function(K){if(K.N==1)return x=g.$9("main_downloads_library_id","mainDownloadsLibraryEntity"),w=g.$9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(K,zI(B,{mode:"readonly",Yb:!0},function(p){return g.M5.all([Lu(p,x,"mainDownloadsLibraryEntity"),Lu(p,w,"mainDownloadsListEntity"),Lu(p,g.OU,"mainDownloadsListEntity")])}),2);
c=K.U;V=g.W(c);Z=V.next().value;R=V.next().value;Y=V.next().value;n=Z;r=R;d=Y;if(!n)return K.t$(0);if(A===g.OU&&((q=d)==null?0:q.downloads))d.downloads=[];else if((f=r)==null?0:f.downloads)for(h=g.IY(A).entityType,P=0;P<r.downloads.length;P++)if(N=r.downloads[P],h==="mainVideoEntity"&&N.videoItem===A){r.downloads.splice(P,1);break}else if(h==="mainPlaylistEntity"&&N.playlistItem===A){r.downloads.splice(P,1);break}return g.y(K,zI(B,{mode:"readwrite",Yb:!0},function(p){var H=[oO(p,n,"mainDownloadsLibraryEntity")];
r&&H.push(oO(p,r,"mainDownloadsListEntity"));d&&H.push(oO(p,d,"mainDownloadsListEntity"));return g.M5.all(H)}),0)})},kf=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q;
return g.u(function(f){if(f.N==1)return x=g.$9(A,"transfer"),w=g.$9(A,"videoDownloadContextEntity"),g.y(f,zI(B,{mode:"readonly",Yb:!0},function(h){return g.M5.all([Lu(h,x,"transfer"),Lu(h,w,"videoDownloadContextEntity")])}),2);
c=f.U;V=g.W(c);Z=V.next().value;R=V.next().value;Y=Z;n=R;q={videoId:A,cotn:(r=Y)==null?void 0:r.cotn,offlineModeType:(d=n)==null?void 0:d.offlineModeType};return f.return(q)})},KB=function(B,A,x,w,c){var V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp;
return g.u(function(S_){switch(S_.N){case 1:return V=g.$9(B,"musicTrack"),Z=g.$9(B,"transfer"),g.y(S_,zI(A,{mode:"readonly",Yb:!0},function(Bp){return g.M5.all([Lu(Bp,V,"musicTrack"),Lu(Bp,Z,"transfer"),tT(Bp,"musicTrack"),tT(Bp,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=S_.U;Y=g.W(R);n=Y.next().value;r=Y.next().value;d=Y.next().value;q=Y.next().value;f=n;h=r;P=d;N=q;if(!f){S_.t$(3);break}return g.y(S_,JVr(f,P),4);case 4:return K=S_.U,g.y(S_,PV(K),3);case 3:p=[];H=g.W(N);for(O=H.next();!O.done;O=H.next())M=O.value,t=g.IY(M.key).entityId,v=$f(M),cp=g.IY(v.action.entityKey).entityId,t!==B&&cp!==B||fB(x,M.actionProto)||p.push(M.key);return g.y(S_,zI(A,{mode:"readwrite",Yb:!0},function(Bp){var L=p.map(function(z){return JT(Bp,z)});
L.push(JT(Bp,V,{wi:!0}));return g.M5.all(L)}),6);
case 6:h_(h),c&&Sw(c),V$(w,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wp(S_)}})},CB=function(B,A,x,w,c){var V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E;
return g.u(function(e){switch(e.N){case 1:return V=g.$9(B,A),Z=g.$9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(e,zI(x,{mode:"readonly",Yb:!0},function(F){return g.M5.all([Lu(F,V,A),Lu(F,Z,"musicDownloadsLibraryEntity"),tT(F,A),tT(F,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=e.U;Y=g.W(R);n=Y.next().value;r=Y.next().value;d=Y.next().value;q=Y.next().value;f=n;h=r;P=d;N=q;if(!f){e.t$(3);break}return g.y(e,JVr(f,P),4);case 4:return K=e.U,g.y(e,PV(K),3);case 3:p=[];H=new Map;if(!f){e.t$(6);break}return g.y(e,vXY(f,P,h),7);case 7:p=e.U;O=g.W(p);for(M=O.next();!M.done;M=O.next())t=M.value,v=g.IY(t).entityId,H.set(v,{videoId:v,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.y(e,sc(x,"transfer"),8);case 8:for(cp=e.U,S_=g.W(cp),
Bp=S_.next();!Bp.done;Bp=S_.next())L=Bp.value,z=g.IY(L.key).entityId,(I=H.get(z))&&L&&(I.cotn=L.cotn);case 6:b=[];Dx=g.W(N);for(Nj=Dx.next();!Nj.done;Nj=Dx.next())Ao=Nj.value,pD=g.IY(Ao.key).entityId,ig=$f(Ao),pD!==B&&ig.rootActionId!==B||fB(w,Ao.actionProto)||b.push(Ao.key);wo=g.$9(B,A);return g.y(e,zI(x,{mode:"readwrite",Yb:!0},function(F){var x$=b.map(function(Va){return JT(F,Va)});
x$.push(JT(F,wo,{wi:!0}));return g.M5.all(x$)}),9);
case 9:if(!f){e.t$(0);break}p.reverse();if(!p.length){e.t$(0);break}I7=g.W(p);k=I7.next();case 12:if(k.done){e.t$(0);break}C=k.value;E=g.IY(C).entityId;if(!E){e.t$(13);break}return g.y(e,KB(E,x,w,c,H.get(E)),13);case 13:k=I7.next(),e.t$(12)}})},pB=function(B,A,x){var w,c,V,Z,R,Y,n;
return g.u(function(r){if(r.N==1)return g.y(r,zI(B,{mode:"readwrite",Yb:!0},function(d){var q=tT(d,"transfer"),f=tT(d,"offlineOrchestrationActionWrapperEntity");return g.M5.all([q,f]).then(function(h){h=g.W(h);var P=h.next().value;var N=h.next().value;h=XG0.map(function(O){return O7h(d,O)});
N=g.W(N);for(var K=N.next();!K.done;K=N.next()){K=K.value;var p=g.IY(K.actionProto.entityKey).entityType==="musicTrack",H=K.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";fB(A,K.actionProto)||p&&(!p||H)||h.push(JT(d,K.key,{wi:!0}))}return g.M5.all(h).then(function(){return P})})}),2);
w=r.U;c=g.W(w);for(V=c.next();!V.done;V=c.next())Z=V.value,h_(Z),R=g.IY(Z.key).entityId,Y={videoId:R,offlineDeleteReason:void 0,cotn:Z.cotn},Sw(Y),n=g.$9(R,"musicTrack"),V$(x,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(r,uEr(),0)})},zvc=function(B){for(var A,x=g.W(B.additionalMetadatas),w=x.next();!w.done;w=x.next())w=w.value,w.offlineMusicVideoData&&(A=w.offlineMusicVideoData);
var c,V,Z,R,Y;return{id:g.$9(B.videoId,"musicTrack"),videoId:B.videoId,title:B.title,thumbnailDetails:B.thumbnail,lengthMs:String(Number(B.lengthSeconds)*1E3),albumTitle:(c=A)==null?void 0:c.releaseTitle,musicVideoType:(V=A)==null?void 0:V.musicVideoType,contentRating:{explicitType:(Z=A)==null?void 0:Z.explicitType},artistNames:((R=A)==null?void 0:R.byline)||((Y=A)==null?void 0:Y.channelName),downloadMetadata:g.$9(B.videoId,"musicTrackDownloadMetadataEntity")}},vXY=function(B,A,x){var w,c,V,Z,R,Y,
n,r,d,q,f,h,P,N,K,p,H,O;
return g.u(function(M){w=[];c=new Set;if((V=x)==null?0:(Z=V.downloadedTracks)==null?0:Z.length)for(R=g.W(x.downloadedTracks),Y=R.next();!Y.done;Y=R.next())n=Y.value,c.add(n);if(B.tracks){r=g.W(B.tracks);for(d=r.next();!d.done;d=r.next())q=d.value,c.has(q)||w.push(q);f=g.W(A);for(h=f.next();!h.done;h=f.next())if(P=h.value,P.id!==B.id&&(N=P.tracks))for(K=g.W(N),p=K.next();!p.done;p=K.next())H=p.value,O=w.indexOf(H),O!==-1&&w.splice(O,1)}return M.return(w)})},JVr=function(B,A){var x,w,c,V,Z,R,Y,n;
return g.u(function(r){x=Q$(B.thumbnailDetails);w=g.W(A);for(c=w.next();!c.done;c=w.next())if(V=c.value,V.id!==B.id)for(Z=g.W(Q$(V.thumbnailDetails)),R=Z.next();!R.done;R=Z.next())Y=R.value,n=x.indexOf(Y),n!==-1&&x.splice(n,1);return r.return(x)})},iVc=function(B,A){var x,w,c,V,Z,R,Y,n,r;
return g.u(function(d){if(d.N==1)return x=g.$9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(d,GI(B,x,"musicDownloadsLibraryEntity"),2);(w=d.U)||(w={id:x});c=g.IY(A).entityType;c==="musicTrack"?(V=w.downloadedTracks)!=null&&V.includes(A)||(w.downloadedTracks=((Z=w.downloadedTracks)!=null?Z:[]).concat(A)):c==="musicPlaylist"?(R=w.downloadedPlaylists)!=null&&R.includes(A)||(w.downloadedPlaylists=((Y=w.downloadedPlaylists)!=null?Y:[]).concat(A)):c!=="musicAlbumRelease"||(n=w.downloadedAlbumReleases)!=
null&&n.includes(A)||(w.downloadedAlbumReleases=((r=w.downloadedAlbumReleases)!=null?r:[]).concat(A));return g.y(d,io(B,w,"musicDownloadsLibraryEntity"),0)})},GEc=function(B,A){var x,w,c,V,Z,R,Y;
return g.u(function(n){if(n.N==1)return x=g.$9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(n,GI(B,x,"musicDownloadsLibraryEntity"),2);w=n.U;if(!w)return n.t$(0);c=g.IY(A).entityType;c==="musicTrack"?V=w.downloadedTracks:c==="musicPlaylist"&&(V=w.downloadedPlaylists);if((Z=V)==null?0:Z.length)for(R=0;R<V.length;R++)if(Y=V[R],Y===A){V.splice(R,1);break}return g.y(n,io(B,w,"musicDownloadsLibraryEntity"),0)})},s4r=function(B){var A=B.videos;
B=[];var x=[];if(A){A=g.W(A);for(var w=A.next();!w.done;w=A.next()){var c=w.value.offlineVideoData.videoId;w=g.$9(c,"musicTrack");c=g.$9(c,"musicTrackDownloadMetadataEntity");B.push(w);x.push(c)}}return{TA:B,Fo:x}},ER=function(B,A,x){A={track:zvc(A)};
x&&(A.playlistId=x);if(B=g.m(B.actionMetadata,Dzh))A.maximumDownloadQuality=B.maximumDownloadQuality;return{musicTrackEntityActionMetadata:A}},APc=function(B){var A,x,w,c,V,Z,R,Y;
return g.u(function(n){switch(n.N){case 1:return A=g.QQ(),x=AV4(B),w=g.NM(BQr),g.Pp(n,2),V={hI:!0},g.y(n,g.VQ(A,x,w,void 0,V),4);case 4:c=n.U;g.Nc(n,3);break;case 2:Z=g.j_(n);if(Z instanceof g.qG)throw R="GetOffline network manager error: "+Z.message,w7(R,Z),Error(R);w7("GetOffline fetch request error",Z);throw Error("GetOffline fetch request error");case 3:Y=y$(c);if(!c)throw w7("Network request failed"),Error("Network request failed");if(Y!==void 0)HV(Y);else if(!c.videos||!c.videos.length)throw w7("No data"),
Error("No data");return n.return(c.videos.map(function(r){return r.offlineVideoData}))}})},xHW=function(B){var A,x,w,c,V,Z,R,Y;
return g.u(function(n){switch(n.N){case 1:return A=g.QQ(),x=xzo(B),w=g.NM(BQr),g.Pp(n,2),V={hI:!0},g.y(n,g.VQ(A,x,w,void 0,V),4);case 4:c=n.U;g.Nc(n,3);break;case 2:Z=g.j_(n);if(Z instanceof g.qG)throw R="GetOffline network manager error for playlist: "+Z.message,w7(R,Z),Error(R);w7("GetOffline fetch request error for playlist",Z);throw Error("GetOffline fetch request error for playlist");case 3:Y=y$(c);if(!c)throw w7("Network request failed for playlist"),Error("Network request failed for playlist");
if(Y!==void 0)HV(Y,"playlist");else if(!c.playlists||!c.playlists.length)throw w7("No data for playlist"),Error("No data for playlist");return n.return(c.playlists.map(function(r){return r.offlinePlaylistData}))}})},cP4=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao;
return g.u(function(pD){switch(pD.N){case 1:return g.y(pD,DQ(),2);case 2:c=pD.U;if(!c)return pD.return([]);V=[];if((Z=w)==null?0:Z.length){V=w;pD.t$(3);break}return g.y(pD,sc(c,"mainPlaylistEntity"),4);case 4:V=pD.U;case 3:if(!V.length)return pD.return([]);R=[];Y=Date.now()/1E3;n=g.W(V);r=n.next();case 5:if(r.done)return R.length?g.y(pD,wNc(R),10):pD.return([]);d=r.value;if(!d.downloadState){q=void 0;pD.t$(8);break}return g.y(pD,GI(c,d.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:q=
pD.U;case 8:f=q;h=void 0;N=(P=(h=d)==null?void 0:h.entityMetadata)&&P.nextAutoRefreshIntervalSeconds?Number(P.nextAutoRefreshIntervalSeconds):NaN;K=Number.isNaN(N)?B:N;H=p=void 0;O=((p=f)==null?0:p.lastSyncedTimestampMillis)?Number((H=f)==null?void 0:H.lastSyncedTimestampMillis)/1E3:0;t=M=void 0;v=((M=f)==null?0:M.addedTimestampMillis)?Number((t=f)==null?void 0:t.addedTimestampMillis)/1E3:0;if(x||!P||O+K<=Y){cp=[];S_=void 0;if((S_=d.videos)==null?0:S_.length)for(Bp=g.W(d.videos),L=Bp.next();!L.done;L=
Bp.next())z=L.value,I=JSON.parse(g.IY(z).entityId),I.videoId&&cp.push(I.videoId);b="0";P&&(Dx=void 0,b=String(Number((Dx=P.offlineLastModifiedTimestampSeconds)!=null?Dx:0).toFixed()));Nj={playlistId:d.playlistId,videoIds:cp,offlineLastModifiedTimestamp:b,autoSync:A,offlineDateAddedTimestamp:String(v.toFixed())};R.push(Nj)}r=n.next();pD.t$(5);break;case 10:return Ao=pD.U,pD.return(Ao)}})},Vnj=function(){var B,A,x,w,c;
return g.u(function(V){if(V.N==1)return g.y(V,DQ(),2);if(V.N!=3)return(B=V.U)?g.y(V,sc(B,"refresh"),3):V.return(!1);A=V.U;if((x=A[0])==null||!x.refreshTime)return V.return(!1);w=Number(A[0].refreshTime);c=Date.now()/1E3;return V.return(isFinite(w)&&c>=w)})},Sv_=function(B,A){var x,w,c;
return g.u(function(V){switch(V.N){case 1:return g.Pp(V,2),g.y(V,ZI_(B,A),4);case 4:return w=V.U,g.y(V,lI4(w),5);case 5:x=mz4(w);g.Nc(V,3);break;case 2:c=g.j_(V),w7("getAndProcessSmartDownloadsResponse request or processing error",c);case 3:return V.return(x)}})},RPo=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao;
return g.u(function(pD){switch(pD.N){case 1:return g.y(pD,DQ(),2);case 2:c=pD.U;if(!c)return pD.return([]);V=[];if((Z=w)==null?0:Z.length){V=w;pD.t$(3);break}return g.y(pD,sc(c,"musicPlaylist"),4);case 4:V=pD.U;case 3:if(!V.length)return pD.return([]);R=[];Y=Date.now()/1E3;n=g.W(V);r=n.next();case 5:if(r.done)return R.length?g.y(pD,wNc(R),10):pD.return([]);d=r.value;q=void 0;h=(f=(q=d)==null?void 0:q.entityMetadata)&&f.nextAutoRefreshIntervalSeconds?Number(f.nextAutoRefreshIntervalSeconds):NaN;P=
Number.isNaN(h)?B:h;K=N=0;p="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!d.downloadMetadata){pD.t$(8);break}return g.y(pD,GI(c,d.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:H=pD.U,M=O=void 0,N=Number((M=(O=H)==null?void 0:O.addedTimestampMillis)!=null?M:"0")/1E3,v=t=void 0,K=Number((v=(t=H)==null?void 0:t.lastModifiedTimestampMillis)!=null?v:"0")/1E3,S_=cp=void 0,p=(S_=(cp=H)==null?void 0:cp.syncState)!=null?S_:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Bp=void 0;if(x||p!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!f||Number((Bp=f.lastSyncedTimestampSeconds)!=null?Bp:0)+P<=Y){L=[];z=void 0;if((z=d.tracks)==null?0:z.length)for(I=g.W(d.tracks),b=I.next();!b.done;b=I.next())Dx=b.value,L.push(g.IY(Dx).entityId);Nj={playlistId:d.playlistId,videoIds:L,offlineLastModifiedTimestamp:String(K.toFixed()),autoSync:A,offlineDateAddedTimestamp:String(N.toFixed())};R.push(Nj)}r=n.next();pD.t$(5);break;case 10:return Ao=pD.U,pD.return(Ao)}})},ZI_=function(B,A){var x,w,c,V,Z,R,Y,n,r,d;
return g.u(function(q){switch(q.N){case 1:return x=g.QQ(),g.y(q,DQ(),2);case 2:w=q.U;if(!w){q.t$(3);break}return g.y(q,YJ4(w),4);case 4:c=q.U;case 3:var f=c;V={context:g.Wj(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:B},offlineClientState:f,clientStateRequestData:{preferredFormatType:A}}}};Z=g.NM(Yvr);g.Pp(q,5);Y={hI:!0};return g.y(q,g.VQ(x,V,Z,void 0,Y),7);case 7:R=q.U;g.Nc(q,6);break;case 5:n=g.j_(q);if(n instanceof g.qG)throw r=
"DPS network manager error for smart downloads: "+n.message,w7(r,n),Error(r);w7("DPS fetch request error for smart downloads",n);throw Error("DPS fetch request error for smart downloads");case 6:d=y$(R);if(R)d!==void 0&&HV(d,"smart downloads");else throw w7("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return q.return(R)}})},rPh=function(B,A){var x,w,c,V,Z,R,Y,n;
return g.u(function(r){switch(r.N){case 1:return x=g.QQ(),w={context:g.Wj(),videoPlaybackPositionEntities:B,lastSyncTimestampUsec:A},c=g.NM(npc),g.Pp(r,2),Z={hI:!0},g.y(r,g.VQ(x,w,c,void 0,Z),4);case 4:V=r.U;g.Nc(r,3);break;case 2:R=g.j_(r);if(R instanceof g.qG)throw Y="VPPS network manager error: "+R.message,w7(Y,R),Error(Y);w7("VPPS fetch request error",R);throw Error("VPPS fetch request error");case 3:n=y$(V);if(V)n!==void 0&&HV(n,"position sync");else throw w7("Network request failed for position sync"),
Error("Network request failed for position sync");return r.return(V)}})},qv7=function(B,A,x){var w,c,V,Z,R,Y,n,r;
return g.u(function(d){switch(d.N){case 1:w=g.QQ();var q=x.refreshData,f=x.isEnqueuedForExpiredStreamUrlRefetch,h=x.q$,P=x.offlineSourceData,N=x.mediaCapabilities,K={entityKey:B};q&&(K.refreshData=q);f&&(K.isExpiredStreamUrlRefetch=f);h&&(K.downloadParameters=h);P&&(K.offlineSourceData=P);q={context:g.wu(A),signatureTimestamp:20118,videos:[K]};N&&(q.mediaCapabilities=N);c=q;V=g.NM(dHY);g.Pp(d,2);R={hI:!0};return g.y(d,g.VQ(w,c,V,void 0,R),4);case 4:Z=d.U;g.Nc(d,3);break;case 2:Y=g.j_(d);if(Y instanceof
g.qG)throw n="GetPDE network manager error: "+Y.message,w7(n,Y),Error(n);w7("GetPDE fetch request error",Y);throw Error("GetPDE fetch request error");case 3:r=y$(Z);if(Z)r!==void 0&&HV(r,"PDE");else throw w7("Network request failed for PDE"),Error("Network request failed for PDE");return d.return(Z)}})},y$=function(B){var A;
return(A=B.errorMetadata)==null?void 0:A.status},HV=function(B,A){A=A?" for "+A:"";
if(B===0)throw B="Empty response body"+A,w7(B),Error(B);B="Response with error"+A;w7(B);throw Error(B);},wNc=function(B){var A,x,w,c,V,Z,R,Y;
return g.u(function(n){switch(n.N){case 1:return A=g.QQ(),x=wGh(B),w=g.NM(fd4),g.Pp(n,2),V={hI:!0},g.y(n,g.VQ(A,x,w,void 0,V),4);case 4:c=n.U;g.Nc(n,3);break;case 2:Z=g.j_(n);if(Z instanceof g.qG)throw R="offlinePlaylistSyncCheck network manager error: "+Z.message,w7(R,Z),Error(R);w7("offlinePlaylistSyncCheck fetch request error",Z);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:Y=y$(c);if(!c)throw w7("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(Y!==void 0)HV(Y,"playlist sync");else if(!c.offlinePlaylistSyncCheckDatas||!c.offlinePlaylistSyncCheckDatas.length)throw w7("No data for playlist sync"),Error("No data for playlist sync");return n.return(c.offlinePlaylistSyncCheckDatas.map(function(r){return r.offlinePlaylistSyncCheckData}))}})},ur=function(B){this.N=B},hPY=function(B,A){var x,w,c,V,Z,R;
return g.u(function(Y){switch(Y.N){case 1:x=new Map,w=g.W(A),c=w.next();case 2:if(c.done){Y.t$(4);break}V=c.value;Z=x;R=Z.set;return g.y(Y,B.U(V),5);case 5:R.call(Z,V,Y.U);c=w.next();Y.t$(2);break;case 4:return Y.return(x)}})},ew=function(B,A,x,w,c,V){A=g.$9(A,x);
w=Object.assign({},V,{priority:w,retryScheduleIntervalsInSeconds:c});return{actionType:B,entityKey:A,actionMetadata:w}},OR=function(B,A,x,w,c,V){this.status=B;
this.N=A;this.D=x;this.U=w;this.S=c;this.downloadState=V},Qd8=function(B,A,x){this.N=B;
this.NZ=A;this.S=x},Weh=function(B,A){var x,w,c,V,Z,R,Y,n,r;
return g.u(function(d){switch(d.N){case 1:return x=A.entityKey,c=(w=g.m(A.actionMetadata,aF))==null?void 0:w.isEnqueuedForExpiredStreamUrlRefetch,g.Pp(d,2),V=void 0,g.y(d,Idc(B,A),4);case 4:V=d.U;g.Pp(d,5);var q=(q=g.m(A.actionMetadata,aF))?{maximumDownloadQuality:q.maximumDownloadQuality}:void 0;return g.y(d,qv7(x,B.NZ,{isEnqueuedForExpiredStreamUrlRefetch:c,q$:q,offlineSourceData:V}),7);case 7:Z=d.U;g.Nc(d,6,2);break;case 5:return g.j_(d,2),R=Yf(A)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",w7("PDE handleAdd error"),d.return(FO(A,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",R,"DOWNLOAD_STATE_FAILED"));case 6:return g.y(d,$Hr(B,Z,A),8);case 8:return d.return(FO(A,!0,Z.orchestrationActions));case 2:return Y=g.j_(d),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.HR&&Y.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w7("PDE handleAdd error"),d.return(FO(A,!1,void 0,n,r,"DOWNLOAD_STATE_FAILED"))}})},NQo=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_;
return g.u(function(Bp){switch(Bp.N){case 1:return x=A.entityKey,w=g.IY(x).entityId,g.y(Bp,zI(B.N,{mode:"readonly",Yb:!0},function(L){var z=Lu(L,x,"playbackData"),I=Lu(L,g.$9(w,"offlineVideoPolicy"),"offlineVideoPolicy");L=Lu(L,g.$9(w,"transfer"),"transfer");return g.M5.all([z,I,L])}),2);
case 2:c=Bp.U;V=g.W(c);Z=V.next().value;R=V.next().value;Y=V.next().value;n=Z;r=R;d=Y;if(!n||!r)return Bp.return(FO(A,!0));q=[];P=((h=n)==null?0:h.playerResponseJson)?JSON.parse(n.playerResponseJson):null;if(!(d&&P&&B.NZ.B("html5_refresh_deprecated_downloads"))){Bp.t$(3);break}f=Pt8(B,P,d);return g.y(Bp,UHW(B,d),4);case 4:q=Bp.U;case 3:N={lastPlayerResponseTimestampSeconds:n.playerResponseTimestamp,offlineToken:r.offlineToken,formatIds:q};K={};if((p=d)==null?0:p.maximumDownloadQuality)K.maximumDownloadQuality=
d.maximumDownloadQuality;g.Pp(Bp,5);H=void 0;return g.y(Bp,Idc(B,A),7);case 7:return H=Bp.U,g.Pp(Bp,8),g.y(Bp,qv7(x,B.NZ,{refreshData:N,q$:K,offlineSourceData:H,mediaCapabilities:f}),10);case 10:O=Bp.U;g.Nc(Bp,9,5);break;case 8:return g.j_(Bp,5),M=Yf(A)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",w7("PDE handleRefresh error"),Bp.return(FO(A,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",M,
"DOWNLOAD_STATE_FAILED"));case 9:return g.y(Bp,$Hr(B,O,A),11);case 11:return Bp.return(FO(A,!0,O.orchestrationActions));case 5:return t=g.j_(Bp),v="PDE handleRefresh error",t instanceof Error&&(v="PDE handleRefresh error: "+t.message),cp="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.HR&&t.type==="QUOTA_EXCEEDED"&&(cp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w7(v),Bp.return(FO(A,!1,void 0,cp,S_,"DOWNLOAD_STATE_FAILED"))}})},Idc=function(B,A){var x,w,c,V;
return g.u(function(Z){if(Z.N==1)return x=g.IY(A.entityKey).entityId,w=g.$9(x,"videoDownloadContextEntity"),g.y(Z,GI(B.N,w,"videoDownloadContextEntity"),2);c=Z.U;return(V=c)!=null&&V.offlineModeType?Z.return({offlineModeType:c.offlineModeType}):Z.return(void 0)})},$Hr=function(B,A,x){var w,c,V,Z,R;
return g.u(function(Y){if(Y.N==1){if(!A.frameworkUpdates||!g.m(A.frameworkUpdates,jw))return Y.return();if(!(g.m(A.frameworkUpdates,jw).mutations&&g.m(A.frameworkUpdates,jw).mutations.length>0&&g.m(A.frameworkUpdates,jw).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return Y.t$(2);w=g.IY(g.m(A.frameworkUpdates,jw).mutations[0].entityKey).entityId;return g.y(Y,kf(B.N,w),3)}if(Y.N!=2){c=Y.U;V=g.m(x.actionMetadata,aF);if(R=(Z=V)==null?void 0:Z.playlistId)c.playlistId=R;c.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Gx(B.NZ)?g.y(Y,NN(w,B.N,x,B.S,c),2):g.zW(B.NZ)?g.y(Y,KB(w,B.N,x,B.S),2):Y.t$(2)}return g.y(Y,vBc(g.m(A.frameworkUpdates,jw)),0)})},FO=function(B,A,x,w,c,V){return new OR(A?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Yf(B),x,w,c,V)},Pt8=function(B,A,x){A=yVr(B.NZ,x.cotn,A);
x=g.Su(A);return g.Oqg(A,x,B.NZ)},UHW=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q;
return g.u(function(f){if(f.N==1)return x=[],g.y(f,zI(B.N,{mode:"readonly",Yb:!0},function(h){var P=[],N=A.offlineVideoStreams;if(N){N=g.W(N);for(var K=N.next();!K.done;K=N.next())P.push(Lu(h,K.value,"offlineVideoStreams"))}return g.M5.all(P)}),2);
if(w=f.U)for(c=g.W(w),V=c.next();!V.done;V=c.next())if(Z=V.value,R=void 0,(R=Z)==null?0:R.streamsProgress)for(Y=Z.streamsProgress,n=0;n<Y.length;n++)r=Y[n],d=JSON.parse(r.formatStreamBytes),q={itag:d.itag,lmt:d.lastModified,xtags:d.xtags},x.push(q);return f.return(x)})},jdV=function(B,A){this.N=B;
this.NZ=A},kir=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f;
return g.u(function(h){switch(h.N){case 1:return x=Yf(A),g.y(h,sc(B.N,"videoPlaybackPositionEntity"),2);case 2:w=h.U;if(w.length===0)return h.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.Pp(h,3);return g.y(h,lo.getInstance(),5);case 5:c=h.U;if(!c)throw Error("prefStorage is undefined");return g.y(h,c.get("psi"),6);case 6:return V=h.U,Y=(R=(Z=V)==null?void 0:Z.Bm)!=null?R:"0",g.y(h,rPh(w,Y),7);case 7:return n=h.U,r={isPaused:n.watchHistoryPaused,Bm:n.syncTimestampUsec},g.y(h,c.set("psi",
r),8);case 8:if(r.isPaused){h.t$(9);break}d=g.m(n.frameworkUpdates,jw);if(!n.frameworkUpdates||!d){h.t$(9);break}return g.y(h,vBc(d),9);case 9:g.Nc(h,4);break;case 3:return q=g.j_(h),f="PPE handleRefresh error: "+(q instanceof Error?q.message:"unknown error"),w7(f),h.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},CtY=function(B,A){var x,w,c,V,Z,R,Y,n;
return g.u(function(r){switch(r.N){case 1:return x=Yf(A),w=g.IY(A.entityKey).entityId,g.Pp(r,2),g.y(r,lo.getInstance(),4);case 4:c=r.U;if(!c)throw Error("prefStorage is undefined");return g.y(r,c.get("psi"),5);case 5:V=r.U;Z=g.m(A.actionMetadata,Ke7);if(((R=V)==null?void 0:R.isPaused)!==!1||(Y=Z)==null||!Y.lastPlaybackPositionSeconds){r.t$(6);break}n={key:g.$9(w,"videoPlaybackPositionEntity"),videoId:w,lastPlaybackPositionSeconds:Z.lastPlaybackPositionSeconds};return g.y(r,io(B.N,n,"videoPlaybackPositionEntity"),
6);case 6:g.Nc(r,3);break;case 2:return g.j_(r),r.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},pNr=function(B,A){var x,w,c;
return g.u(function(V){switch(V.N){case 1:x=Yf(A);g.Pp(V,2);w=g.IY(A.entityKey).entityId;if(w==="!*$_ALL_ENTITIES_!*$")return g.y(V,Lk7(B.N),5);c=g.$9(w,"videoPlaybackPositionEntity");return g.y(V,mbW(B.N,c),5);case 5:g.Nc(V,3);break;case 2:return g.j_(V),V.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},EpW=function(B,A){this.api=B;
this.N=A;this.logger=new g.cn("woffle");this.U=!1;this.v3={Zq:this.Zq};this.logger.debug("Initialized OfflineMediaManager")},yPY=function(B){return g.u(function(A){return A.return(BBr(B))})},HI8=function(B){var A;
return g.u(function(x){if(x.N==1)return g.y(x,g.Blx(B),2);A=x.U;return x.return(A.filter(function(w){return!!w.url}).map(function(w){return w.url}))})},g7=function(B,A){var x=g.yW(A);
if(x===1||x===0)return Promise.resolve();(x=uc7(B,A))&&x.stopVideo();B.S=0;return yPY(A)},MN=function(B,A,x,w){x=x===void 0?!1:x;
w=w===void 0?!0:w;var c=typeof A==="string"?A:A.videoDetails.videoId;g.yW(c)===2&&((A=uc7(B,c))?A.stopVideo():B.logger.info(function(){return"Corresponding player for "+c+" not found. Pausing anyway"}),g.HD(c,2),B.S=2,x?ePj(B.N):w&&OIY(B.N))},uc7=function(B,A){var x;
return((x=B.player)==null?void 0:x.getVideoData().videoId)===A?B.player:null},adh=function(B,A,x){A.getPlayerResponse();
g.HD(A.videoId,2);B.S=2;B.U=!1;var w;(w=B.player)==null||w.dispose();B.player=B.api.wJ(A);A={};B.player.wR((A.localmediachange=B.Vs,A.signatureexpired=B.Fp,A.statechange=B.c5R,A),B);var c=B.Zq(x);B.player.pp(g.Vc(c,c,!0,"m"),!1);B.logger.debug(function(){return"Starting headless playback with quality: "+c});
B.player.qp(!1)},FeV=function(B,A){this.N=B;
this.NZ=A},Mnh=function(B,A){var x,w;
return g.u(function(c){switch(c.N){case 1:return x=Yf(A),g.y(c,GI(B.N,A.entityKey,"transfer"),2);case 2:if(w=c.U)return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.Pp(c,3);return g.y(c,gpr(B,A),5);case 5:g.Nc(c,4);break;case 3:return g.j_(c),c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},ld4=function(B,A){var x,w;
return g.u(function(c){switch(c.N){case 1:return x=Yf(A),g.y(c,GI(B.N,A.entityKey,"transfer"),2);case 2:w=c.U;if(!w||w.transferState!=="TRANSFER_STATE_COMPLETE")return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.Pp(c,3);return g.y(c,gpr(B,A,!0),5);case 5:g.Nc(c,4);break;case 3:return g.j_(c),c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},TQW=function(B,A){var x,w,c,V,Z,R,Y,n,r,d;
return g.u(function(q){switch(q.N){case 1:return x=Yf(A),w=g.IY(A.entityKey).entityId,g.y(q,zI(B.N,{mode:"readonly",Yb:!0},function(f){var h=Lu(f,A.entityKey,"transfer");f=Lu(f,g.$9(w,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.M5.all([h,f])}),2);
case 2:c=q.U;V=g.W(c);Z=V.next().value;R=V.next().value;Y=Z;n=R;if(!Y||Y.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return q.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.Pp(q,3);Y.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.y(q,io(B.N,Y,"transfer"),5);case 5:r=g.IY(Y.key).entityId;RF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:r,v7:Y,offlineModeType:(d=n)==null?void 0:d.offlineModeType});g.Nc(q,
4);break;case 3:return g.j_(q),q.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},gpr=function(B,A,x){x=x===void 0?!1:x;
var w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K;return g.u(function(p){switch(p.N){case 1:return w=g.m(A.actionMetadata,mHh),c=g.IY(A.entityKey).entityId,V=g.$9(c,"downloadStatusEntity"),g.y(p,zI(B.N,{mode:"readonly",Yb:!0},function(H){var O=Lu(H,V,"downloadStatusEntity");H=Lu(H,g.$9(c,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.M5.all([O,H])}),2);
case 2:return Z=p.U,R=g.W(Z),Y=R.next().value,n=R.next().value,r=Y,d=n,q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((f=r)==null?void 0:f.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(q="TRANSFER_STATE_PAUSED_BY_USER"),N={key:A.entityKey,transferState:q,cotn:g.FP(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(h=w)==null?void 0:h.maximumDownloadQuality,preferredAudioTrack:(P=w)==null?void 0:P.preferredAudioTrack,transferRetryCount:0,isRefresh:x,hasLoggedFirstStarted:!1},g.y(p,zI(B.N,
{mode:"readwrite",Yb:!0},function(H){var O=[];x&&O.push(JT(H,g.$9(c,"offlineVideoStreams")));O.push(oO(H,N,"transfer"));return g.M5.all(O)}),3);
case 3:if(!x){p.t$(4);break}return g.y(p,yPY(c),4);case 4:RF({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:c,v7:N,offlineModeType:(K=d)==null?void 0:K.offlineModeType}),g.Wp(p)}})},tno=function(B,A,x,w){if(!B.action.entityKey)throw Error("entityKey is missing.");
var c=g.IY(B.action.entityKey);c={entityType:c.B2,entityId:c.entityId,offlineOrchestrationActionType:B.action.actionType,orchestrationAction:{orchestrationActionId:B.actionId}};A&&(c.offlineOrchestrationActionResult=A.status,c.isRetryable=x?!1:A.N,A.S&&(c.offlineOrchestrationFailureReason=Le0(A.S,c.isRetryable)));var V,Z;if((V=B.action.actionMetadata)==null?0:(Z=V.offlineLoggingData)==null?0:Z.offlineModeType)c.offlineModeType=B.action.actionMetadata.offlineLoggingData.offlineModeType;w&&(c.additionalOrchestrationActions=
w.map(function(R){return{orchestrationActionId:R.actionId}}));
return c},Le0=function(B,A){return B!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||A?B==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&A?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":B:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},bI0=function(B,A){var x={offlineOrchestrationContext:tno(B)};
A=SJ_(A,x);Rv_(ZVo(),A,B.rootActionId)},op0=function(B,A,x,w){w=w===void 0?[]:w;
A={offlineOrchestrationContext:tno(B,A,x,w)};A=SJ_(3,A);Rv_(ZVo(),A,B.rootActionId)},JPW=function(){this.actions=[]},vpY=function(B,A){A=g.W(A);
for(var x=A.next();!x.done;x=A.next())x=x.value,bI0(x,1),B.actions.push(x);B.actions.sort(B.N)},XNo=function(B,A){if(A)for(var x=0;x<B.actions.length;x++)if(A==="!*$_ALL_ENTITIES_!*$"&&B.actions[x].actionId!==A||A!=="!*$_ALL_ENTITIES_!*$"&&B.actions[x].rootActionId===A&&B.actions[x].actionId!==A)B.actions.splice(x,1),x--},zP0=function(B,A){B=g.W(B.actions);
for(var x=B.next();!x.done;x=B.next())if(x.value.actionId===A)return!0;return!1},lr=function(B,A,x,w,c){g.l.call(this);
var V=this;this.U=B;this.qZ=A;this.A$=x;this.T=w;this.NZ=c;this.N=new JPW;this.Y=new g.S6;this.S=new g.dN(function(){V.retry()});
this.j=NaN;this.K=!1;this.v3={wuk:function(){return V.N},
FL:function(){return V.Y},
BFF:function(){return V.S},
retry:function(){return V.retry()}};
g.T(this,this.S);this.Z=this.U.observe(this.Et.bind(this))},sdo=function(B,A,x,w,c){var V;
return g.u(function(Z){if(Z.N==1)return V=new lr(B,A,x,w,c),g.y(Z,iIr(V),2);GiW(V);return Z.return(V)})},GiW=function(B){var A=B.N.actions[0];
return B.D?((A==null?void 0:A.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&B.D[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(B.K=!0),Promise.resolve()):DHr(B)},DHr=function(B){var A,x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K;
return g.u(function(p){switch(p.N){case 1:if(B.D)throw Error("Already processing an action");if(B.aS())return p.return();A=B.N.actions.shift();UzV(B.A$,!A);if(A===void 0)return p.return();A.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&A.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&XNo(B.N,A.actionId);x="";A.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&A.rootActionId===A.actionId&&(x=A.actionId);w=[A];B.D=w;if(c=B.qZ[A.entityType]){p.t$(2);break}B.D=
void 0;return g.y(p,DHr(B),3);case 3:return p.return();case 2:V=g.W(w);for(Z=V.next();!Z.done;Z=V.next())R=Z.value,bI0(R,2);g.Pp(p,4,5);return g.y(p,hPY(c,w.map(function(H){return H.action})),7);
case 7:Y=p.U,n=g.W(w),r=n.next();case 8:if(r.done){p.t$(10);break}d=r.value;q=Y.get(d.action);return g.y(p,BXr(B,d,q),9);case 9:r=n.next();p.t$(8);break;case 10:XNo(B.N,x);case 5:g.k$(p);B.D=void 0;g.KD(p,6);break;case 4:return f=g.j_(p),w7("Orchestration error",f),g.Pp(p,12),g.y(p,A3Y(B,w),14);case 14:g.Nc(p,5);break;case 12:h=g.j_(p);w7("Orchestration retry error",h);P=g.W(w);for(N=P.next();!N.done;N=P.next())K=N.value,K.retryScheduleIndex<3&&vpY(B.N,[K]);p.t$(5);break;case 6:return g.y(p,DHr(B),
0)}})},BXr=function(B,A,x){var w,c,V,Z,R,Y,n,r,d,q,f,h;
return g.u(function(P){switch(P.N){case 1:w=A.retryScheduleIndex+2===3;if(x.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){P.t$(2);break}if(x.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){P.t$(0);break}op0(A,x,w);if(x.N&&A.retryScheduleIndex+1<3)return g.y(P,A3Y(B,[A]),0);V=((c=x)==null?0:c.U)?x.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";Z={entityKey:A.action.entityKey,failureReason:V};R=void 0;g.Gx(B.NZ)?R="mainVideoDownloadStateEntity":g.zW(B.NZ)&&(R="musicTrackDownloadMetadataEntity");
if(!R||!x.downloadState){P.t$(7);break}Y=g.IY(A.action.entityKey).entityId;return g.y(P,qN(Y,R,B.U,x.downloadState),7);case 7:V$(B.T,Z);if(x.downloadState==="DOWNLOAD_STATE_FAILED"&&B.NZ.B("html5_auto_retry_failed_pde_actions")){P.t$(0);break}w7("Orchestration result is not retryable, deleting action");return g.y(P,mbW(B.U,WV(A).key),0);case 2:n=void 0;try{n=(r=x.D)==null?void 0:r.map(function(N){return B.createAction(N,A)})}catch(N){return op0(A,x,w),d={entityKey:A.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},V$(B.T,d),w7("Orchestration subactions creation error",N),P.return()}op0(A,x,w,n);if(!n){P.t$(12);break}q=n.map(function(N){return WV(N)});
f=0;case 13:if(!(f<n.length)||B.K){P.t$(15);break}return g.y(P,zI(B.U,{mode:"readwrite",Yb:!0},function(N){var K=[];K.push(H7Y(N,q.slice(f,f+10),"offlineOrchestrationActionWrapperEntity"));return g.M5.all(K)}),16);
case 16:f+=10;P.t$(13);break;case 15:if(B.K)return B.K=!1,P.return();case 12:return h=WV(A),g.y(P,mbW(B.U,h.key),17);case 17:bI0(A,4),g.Wp(P)}})},Vvr=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f;
return g.u(function(h){x=[];w=Infinity;c=4E3;V=g.W(A);for(Z=V.next();!Z.done;Z=V.next())R=Z.value,Y=Number(R.enqueueTimeSec),n=xEr(Y),r=R.retryScheduleIndex,d=r!=null&&r>0,n>0&&d?(w=Math.min(w,Y),c=Math.min(n,c)):x.push(R);isFinite(w)&&(!B.S.isActive()||w<B.j)&&(B.j=w,B.S.start(c));B.Y.PS()||(q=x.length,x=x.filter(function(P){var N;P=((N=P.actionProto)==null?void 0:N.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!wUW.includes(P)}),f=x.length<q,!B.S.isActive()&&f&&B.S.start(1));
x.length>0&&c3h(B,x);return g.y(h,GiW(B),0)})},Ss_=function(B){var A,x,w,c,V,Z,R;
return g.u(function(Y){if(Y.N==1)return g.y(Y,Z6Y(B),2);A=Y.U;x=[];w=g.W(A);for(c=w.next();!c.done;c=w.next())V=c.value,Z=g.IY(V.key),R=Z.entityId,zP0(B.N,R)||x.push(V);return g.y(Y,Vvr(B,x),0)})},xEr=function(B){B=B*1E3-Date.now();
return B>4E3?4E3:B},A3Y=function(B,A){var x,w,c;
return g.u(function(V){x=g.W(A);for(w=x.next();!w.done;w=x.next()){c=w.value;var Z=void 0,R=void 0,Y=((R=c.action)==null?void 0:(Z=R.actionMetadata)==null?void 0:Z.retryScheduleIntervalsInSeconds)||[1,2,4];Z=1;c.retryScheduleIndex<Y.length&&(Z=Y[c.retryScheduleIndex]);c.N=Z*1E3+Date.now();c.retryScheduleIndex++}return g.y(V,RIW(B,A),0)})},iIr=function(B){var A;
return g.u(function(x){if(x.N==1)return g.y(x,sc(B.U,"offlineOrchestrationActionWrapperEntity"),2);A=x.U;return g.y(x,Vvr(B,A),0)})},c3h=function(B,A){A.length!==0&&A.forEach(function(x){x=$f(x);
x.retryScheduleIndex<3&&vpY(B.N,[x])})},Z6Y=function(B,A){var x;
return g.u(function(w){if(w.N==1)return g.y(w,sc(B.U,"offlineOrchestrationActionWrapperEntity",A),2);x=w.U;return w.return(x.filter(XXh))})},RIW=function(B,A){if(A.length===0)return Promise.resolve([]);
A=A.map(function(x){return WV(x)});
return Tq_(B.U,A)},YsW=function(B){this.BR=B;
this.N=void 0},nOW=function(B,A){var x,w,c,V;
return g.u(function(Z){x=A.videoId;w=!0;if(A.captionTracks.length)c=HMr(A),B.N=new g.uG(B.BR,A,c);else if(A.OS)V=g.YOg(A),B.N=new g.Oy(B.BR,A.OS,x,V,A.Qz,A.eventId),w=A.Qz;else return Z.return();return Z.return(new Promise(function(R){var Y;(Y=B.N)==null||Y.FU({LW:function(){return g.u(function(n){if(n.N==1)return g.y(n,B.LW(x,w),2);R();g.Wp(n)})},
jl:function(){}})}))})},r3_=function(B){var A;
return g.u(function(x){if(x.N==1)return g.y(x,DbY(B),2);A=x.U;return x.return(!!A&&A.length>0)})},Tl=function(B){g.l.call(this);
this.N=B;this.U=this.N.observe(this.S.bind(this))},dEc=function(B,A){var x,w,c,V,Z,R,Y;
return g.u(function(n){switch(n.N){case 1:if(A.length===0)return n.return([]);x=A.map(function(r){return g.$9(r,"transfer")});
return g.y(n,sc(B.N,"transfer",x),2);case 2:w=n.U;c=w.filter(XXh).map(function(r){return g.IY(r.key).entityId});
V=A.filter(function(r){return c.indexOf(r)===-1});
if(V.length===0)return n.return([]);Z=g.W(V);R=Z.next();case 3:if(R.done){n.t$(5);break}Y=R.value;return g.y(n,yPY(Y),4);case 4:R=Z.next();n.t$(3);break;case 5:return n.return(V)}})},hIV=function(B,A,x,w,c,V){var Z,R,Y;
return g.u(function(n){Z="STREAM_TYPE_UNKNOWN";x.video&&x.audio?(Z="STREAM_TYPE_AUDIO_AND_VIDEO",w7("unexpected stream type")):x.video&&!x.audio?Z="STREAM_TYPE_VIDEO":!x.video&&x.audio&&(Z="STREAM_TYPE_AUDIO");R=g.$9(A,"offlineVideoStreams");Y={numBytesDownloaded:c.toFixed(),numTotalBytes:V.toFixed(),streamType:Z,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(w),itag:Z==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(x.itag):void 0};return g.y(n,zI(B,{mode:"readwrite",Yb:!0},
function(r){var d=Lu(r,R,"offlineVideoStreams"),q=Lu(r,g.$9(A,"transfer"),"transfer");return g.M5.all([d,q]).then(function(f){f=g.W(f);var h=f.next().value;f=f.next().value;if(!f)return JT(r,R).then(function(){});
var P=qs0(h);h=fDr(h,w,Y,R);var N=oO(r,h,"offlineVideoStreams");qs0(h)>P&&(f.lastProgressTimeMs=Date.now().toString());P=[N];f.offlineVideoStreams||(f.offlineVideoStreams=[]);f.offlineVideoStreams.indexOf(R)===-1&&(f.offlineVideoStreams.push(R),P.push(oO(r,f,"transfer")));return g.M5.all(P)})}),0)})},QM0=function(B,A){var x,w,c,V,Z;
return g.u(function(R){if(R.N==1)return x=g.$9(A,"offlineVideoStreams"),g.y(R,GI(B,x,"offlineVideoStreams"),2);w=R.U;if(!w||!w.streamsProgress)return R.return();c=g.W(w.streamsProgress);for(V=c.next();!V.done;V=c.next())Z=V.value,Z.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",Z.numTotalBytes!==Z.numBytesDownloaded&&(Z.numBytesDownloaded=Z.numTotalBytes);return g.y(R,io(B,w,"offlineVideoStreams"),0)})},fDr=function(B,A,x,w){if(B&&B.streamsProgress){w=B;
a:{A=A.itag+";"+A.xtags;for(var c=B.streamsProgress,V=0;V<c.length;V++){var Z=JSON.parse(c[V].formatStreamBytes);if(Z.itag+";"+Z.xtags===A){c[V]=x;x=c;break a}}c.push(x);x=c}w.streamsProgress=x}else B={key:w,streamsProgress:[x]};return B},qs0=function(B){if(B==null?0:B.streamsProgress){var A=0;
B=B.streamsProgress;for(var x=0;x<B.length;x++){var w=B[x];isNaN(Number(w.numBytesDownloaded))?w7("stream progress bytes number invalid"):A+=Number(w.numBytesDownloaded)}return A}return 0},IDh=function(B,A,x,w){g.l.call(this);
var c=this;this.U=B;this.api=A;this.LF=x;this.Et=w;this.Y=new g.S6;this.D=new g.dN(function(){c.N&&c.N.transferState==="TRANSFER_STATE_TRANSFERRING"&&c.Y.PS()&&((c.N.transferRetryCount||0)<3?MN(c.T,c.K,!1,!1):g7(c.T,c.K.videoDetails.videoId),c.EV("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.A$=this.fF=0;this.Z=this.j=!1;this.GM=g.N2(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.KF=new g.be(this);this.v3={CR$:function(){return c.D},
fVZ:function(){return c.Et},
FL:function(){return c.Y}};
this.qZ=this.U.observe(this.Lj.bind(this));this.T=new EpW(A,this);this.h$=new YsW(A);this.XR=new Tl(this.U);this.J$=this.Y.listen("publicytnetworkstatus-online",this.Hx.bind(this));this.PR=this.Y.listen("publicytnetworkstatus-offline",this.uSF.bind(this));this.Z=this.api.C().B("html5_less_transfer_processing_logs");g.T(this,this.KF);this.KF.G(A,"offlinetransferpause",this.Xlt);g.Gx(this.api.C())?this.S="mainVideoDownloadStateEntity":g.zW(this.api.C())&&(this.S="musicTrackDownloadMetadataEntity")},
$Er=function(B){return g.u(function(A){if(A.N==1)A=g.y(A,G18(),2);
else{var x=B.XR;var w=g.EH();w=Object.keys(w);x=dEc(x,w);A=g.y(A,x,0)}return A})},LB=function(B,A){A=A===void 0?!1:A;
var x;return g.u(function(w){if(w.N==1){if(B.N)throw Error("Already downloading a video");B.A$=0;B.j=!1;return g.y(w,W3_(B),2)}return w.N!=4?(x=w.U,NBh(B.LF,!x),x&&B.Y.PS()?A?g.y(w,new Promise(function(c){g.yL(c,1E3)}),4):w.t$(4):(!x&&B.N&&m$(B),w.t$(0))):g.y(w,Pd_(B,x),0)})},UEr=function(B){return g.u(function(A){if(A.N==1)return B.K?g.y(A,g7(B.T,B.K.videoDetails.videoId),3):A.t$(0);
m$(B);g.Wp(A)})},NXh=function(B,A){var x,w,c;
return g.u(function(V){switch(V.N){case 1:return g.Pp(V,2),(x=!!A.captionTracks.length||!!A.OS)?g.y(V,r3_(A.videoId),4):V.return();case 4:return(w=V.U)?V.return():g.y(V,nOW(B.h$,A),5);case 5:g.Nc(V,0);break;case 2:c=g.j_(V),w7("Caption downloading error",c,A.cotn),g.Wp(V)}})},Pd_=function(B,A){var x,w,c,V,Z,R;
return g.u(function(Y){switch(Y.N){case 1:if(B.j)return Y.return();B.j=!0;B.N=A;x=g.IY(B.N.key);w=x.entityId;c=void 0;if(B.N.transferState==="TRANSFER_STATE_TRANSFERRING")return g.y(Y,t_(B,w),7);if(B.N.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||B.N.transferRetryCount||B.N.hasLoggedFirstStarted){Y.t$(3);break}return g.y(Y,t_(B,w),5);case 5:return c=Y.U,B.N.hasLoggedFirstStarted=!0,g.y(Y,jMh(B),6);case 6:j4_({videoId:w,v7:B.N,offlineModeType:c},void 0,void 0,!0);Y.t$(3);break;case 7:c=Y.U,
RF({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:w,v7:B.N,offlineModeType:c});case 3:return g.y(Y,kd0(B),8);case 8:return V=null,g.Pp(Y,9),g.y(Y,K30(B,A),11);case 11:V=Y.U;B.K=V;g.Nc(Y,10);break;case 9:return Z=g.j_(Y),w7("error getting player response",Z,A.cotn),g.y(Y,B.EV("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return Y.return();case 10:return R=yVr(B.api.C(),A.cotn,V),g.y(Y,NXh(B,R),13);case 13:return g.y(Y,HI8(R.videoId),
14);case 14:R.eU=Y.U,adh(B.T,R,A.maximumDownloadQuality),B.D.start(108E5),g.Wp(Y)}})},W3_=function(B){var A,x;
return g.u(function(w){if(w.N==1)return g.y(w,sc(B.U,"transfer"),2);A=w.U;x=A.filter(CdY).sort(pUY);return x.length===0?w.return():w.return(x[0])})},kd0=function(B){var A,x,w;
return g.u(function(c){if(c.N==1){if(!B.N)return br(B,"onTransferStart"),c.return();B.D.start(108E5);return g.y(c,oF(B,"TRANSFER_STATE_TRANSFERRING"),2)}A=B.N;return(w=((x=A)==null?0:x.key)?g.IY(A.key).entityId:"")&&B.S?g.y(c,qN(w,B.S,B.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):c.t$(0)})},ePj=function(B){var A,x,w,c;
g.u(function(V){switch(V.N){case 1:if(!B.N){br(B,"onTransferPausedByUser");V.t$(2);break}A=B.N;B.D.stop();return g.y(V,oF(B,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:w=((x=A)==null?0:x.key)?g.IY(A.key).entityId:"";if(!w||!B.S){V.t$(4);break}return g.y(V,qN(w,B.S,B.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.y(V,t_(B,w),6);case 6:c=V.U,kEo({videoId:w,v7:A,offlineModeType:c});case 2:m$(B),LB(B),g.Wp(V)}})},OIY=function(B){var A,x,w;
g.u(function(c){if(c.N==1){if(!B.N)return br(B,"onTransferPausedByNetwork"),c.return();B.D.stop();return g.y(c,oF(B,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(c.N!=3)return A=B.N,(w=((x=A)==null?0:x.key)?g.IY(A.key).entityId:"")&&B.S?g.y(c,qN(w,B.S,B.U,"DOWNLOAD_STATE_PAUSED"),3):c.t$(3);m$(B);g.Wp(c)})},EOh=function(B){var A,x,w,c,V;
g.u(function(Z){switch(Z.N){case 1:if(!B.N)return br(B,"onTransferComplete"),Z.return();A=B.N;B.D.stop();if(!A||!B.K){Z.t$(2);break}x=yVr(B.api.C(),A.cotn,B.K);return g.y(Z,NXh(B,x),2);case 2:return g.y(Z,oF(B,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:c=((w=A)==null?0:w.key)?g.IY(A.key).entityId:"";if(!c||!B.S){Z.t$(5);break}return g.y(Z,qN(c,B.S,B.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.y(Z,QM0(B.U,c),7);case 7:return g.y(Z,t_(B,c),8);case 8:V=Z.U,RF({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:c,v7:A,offlineModeType:V}),m$(B),LB(B),g.Wp(Z)}})},y3o=function(B,A,x){var w,c;
g.u(function(V){switch(V.N){case 1:if(!B.N)return br(B,"onTransferProgress: "+A),V.return();if(B.N.transferState==="TRANSFER_STATE_TRANSFERRING"){V.t$(2);break}return g.y(V,kd0(B),2);case 2:w=Date.now();if(!(w-B.fF>1E3)){V.t$(4);break}B.fF=w;return g.y(V,hIV(B.U,x.videoId,x.U,x.HG,x.bytesDownloaded,x.N),5);case 5:if(B.Z&&!(B.Z&&w-B.A$>B.GM)){V.t$(4);break}B.A$=w;return g.y(V,t_(B,A),7);case 7:c=V.U,j4_({videoId:A,v7:B.N,offlineModeType:c},x.bytesDownloaded,x.N);case 4:B.D.start(108E5),g.Wp(V)}})},
H6r=function(B){var A=(B.N.transferRetryCount||0)<3;
A&&(B=B.N,B.transferRetryCount=(B.transferRetryCount||0)+1);return A},ubo=function(B,A){A=A===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":A;
var x,w,c,V;return g.u(function(Z){if(Z.N==1)return B.N||br(B,"setTransferToFailed: "+A),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A==="TRANSFER_FAILURE_REASON_NETWORK"?x="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":A==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.y(Z,oF(B,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",A),2);if(Z.N!=3)return V$(B.Et,{entityKey:(w=B.N)==null?void 0:w.key,failureReason:x}),
c=B.N?g.IY(B.N.key).entityId:"",g.y(Z,t_(B,c),3);V=Z.U;var R={videoId:c,v7:B.N,offlineModeType:V},Y=A,n={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};Y&&(n.transferFailureReason=Y,n.failureReason=Klo(Y));RF(n,R);g.Wp(Z)})},oF=function(B,A,x,w){var c;
return g.u(function(V){if(V.N==1){if(!B.N)return br(B,"saveTransferState: "+A),V.return();B.N.transferState=A;B.N.failureReason=w;g.Pp(V,2);return g.y(V,jMh(B,function(Z){return x?tT(Z,"offlineVideoStreams",B.N.offlineVideoStreams).then(function(R){for(var Y=g.W(R),n=Y.next();!n.done;n=Y.next())if((n=n.value)&&n.streamsProgress){n=g.W(n.streamsProgress);for(var r=n.next();!r.done;r=n.next())r.value.streamState=x}return H7Y(Z,R.filter(function(d){return!!d}),"offlineVideoStreams")}):g.M5.resolve(void 0)}),
4)}if(V.N!=2)return g.Nc(V,0);
c=g.j_(V);return c instanceof g.HR&&c.type==="QUOTA_EXCEEDED"?g.y(V,B.EV("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):V.t$(0)})},jMh=function(B,A){var x;
return g.u(function(w){if(!B.N)return w.return();x=B.N;return g.y(w,zI(B.U,{mode:"readwrite",Yb:!0},function(c){var V=[oO(c,x,"transfer")];A&&V.push(A(c));return g.M5.all(V)}),0)})},m$=function(B){B.N=void 0;
B.K=void 0;B.D.stop()},K30=function(B,A){var x,w,c,V,Z;
return g.u(function(R){if(R.N==1)return x=g.IY(A.key),w=x.entityId,c=g.$9(w,"playbackData"),g.y(R,GI(B.U,c,"playbackData"),2);V=R.U;if((Z=V)==null?0:Z.playerResponseJson)return R.return(JSON.parse(V.playerResponseJson));throw Error("No PlayerResponse found");})},br=function(B,A){B.api.yP("woffle",{mcte:A});
w7("missing current transfer entity.")},t_=function(B,A){var x,w,c;
return g.u(function(V){if(V.N==1)return g.y(V,GI(B.U,g.$9(A,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);x=V.U;return V.return((c=(w=x)==null?void 0:w.offlineModeType)!=null?c:void 0)})},CdY=function(B){return eIr[B.transferState]!==void 0},pUY=function(B,A){var x=eIr[B.transferState],w=eIr[A.transferState];
return x!==w?x-w:Number(B.enqueuedTimestampMs)-Number(A.enqueuedTimestampMs)},J_=function(B,A){var x=this;
this.NZ=B;this.api=A;this.Y=new g.S6;this.K=new g.CM;this.v3={KP:function(){return x.S.v3.KP()},
FL:function(){return x.Y},
Qht:function(){return x.S},
qF:function(){return x.qF()},
hY:function(){return x.hY()},
mD:function(){return x.mD()},
Nl:function(){return x.Nl()},
lT:function(){return x.lT()},
wE:function(w){return x.wE(w)}};
this.S=new $zc(function(){return O6V(x)},function(){x.mD()},this.api.E1(),this.api.B.bind(this.api));
this.N=new cV(this.api);Wlr(this.S)},O6V=function(B){return g.u(function(A){B.api.m7("onOrchestrationBecameLeader");
return g.y(A,B.hY(),0)})},F34=function(B){var A,x;
return g.u(function(w){if(w.N==1)return g.y(w,DQ(),2);if(w.N!=3){A=w.U;if(!A)return w7("PES is undefined"),w.return();B.U=new IDh(A,B.api,B.S,B.N);x=B.XQ(A);return g.y(w,sdo(A,x,B.S,B.N,B.NZ),3)}B.T=w.U;return g.y(w,aD0(B),0)})},aD0=function(B){var A;
return g.u(function(x){switch(x.N){case 1:if(!B.U)return w7("transferManager is undefined"),x.return();if(B.U.N){x.t$(2);break}return g.y(x,LB(B.U),2);case 2:if(!B.NZ.B("woffle_enable_main_downloads_library")){x.t$(4);break}return g.y(x,B.xg(),4);case 4:if(!B.NZ.B("html5_offline_playback_position_sync")){x.t$(6);break}return g.y(x,B.E9(),7);case 7:return g.y(x,B.wE(864E5),6);case 6:return g.y(x,B.refreshAllStaleEntities(43200,!0),9);case 9:return g.y(x,B.HI(),10);case 10:if(!B.NZ.B("html5_retry_downloads_for_expiration")){x.t$(11);
break}return g.y(x,B.lT(),11);case 11:return B.j=g.H2(function(){B.refreshAllStaleEntities(43200,!0);B.HI()},9E5),g.ds(g.fk(),function(){return B.Nl()}),g.y(x,DQ(),13);
case 13:return A=x.U,g.y(x,II4(A),14);case 14:PHY(B.S),g.Wp(x)}})},gO7=function(){var B,A,x,w,c,V;
return g.u(function(Z){switch(Z.N){case 1:return g.y(Z,DQ(),2);case 2:B=Z.U;if(!B)return Z.return([]);A=Date.now()/1E3;return g.y(Z,sc(B,"offlineVideoPolicy"),3);case 3:x=Z.U,w=g.W(x),c=w.next();case 4:if(c.done){Z.t$(6);break}V=c.value;if(!(V.expirationTimestamp&&Number(V.expirationTimestamp)<A)){Z.t$(5);break}V.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";V.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.y(Z,io(B,V,"offlineVideoPolicy"),5);
case 5:c=w.next();Z.t$(4);break;case 6:return Z.return(x.map(function(R){return R.key}))}})},vV=function(B,A,x,w,c){var V,Z,R;
return g.u(function(Y){if(Y.N==1)return g.y(Y,DQ(),2);V=Y.U;if(!V)return Y.return([]);Z=A.map(function(n){var r=g.$9(n,x);r={actionType:w,entityKey:r,actionMetadata:Object.assign({},HVV(),c)};w!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(r.actionMetadata.priority=0);n=new IF(x,n,r);return WV(n)});
R=Tq_(V,Z);Wlr(B.S);return Y.return(R)})},Mv8=function(B,A,x,w){var c,V,Z,R,Y,n,r,d;
return g.u(function(q){switch(q.N){case 1:c=[],V=g.W(A),Z=V.next();case 2:if(Z.done){q.t$(4);break}R=Z.value;if(R.upToDate||x&&!R.shouldAutoSyncMetadata||!R.playlistId){q.t$(3);break}Y={};switch(w){case "mainPlaylistEntity":n={nextAutoRefreshIntervalSeconds:R.checkInSeconds,autoSync:x};Y={mainPlaylistEntityActionMetadata:n};break;case "musicPlaylist":r={autoSync:x},Y={musicPlaylistEntityActionMetadata:r}}return g.y(q,vV(B,[R.playlistId],w,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y),6);case 6:(d=
q.U)&&c.push.apply(c,g.U(d));case 3:Z=V.next();q.t$(2);break;case 4:return q.return(c)}})},lDV=function(B,A){var x;
return g.u(function(w){return A.length?(x=HVV(),g.sh(x,aF,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B.api.yP("qrd",{v:A.length}),w.return(vV(B,A,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x))):w.return([])})},TXW=function(B,A,x){this.N=B;
this.NZ=A;this.S=x},tvo=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p;
return g.u(function(H){switch(H.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,V=[],g.Pp(H,2),g.y(H,mEr(B,c),4);case 4:V=H.U;if(!(B.NZ.B("woffle_enable_main_downloads_library")&&((Z=V)==null?0:Z.length))){H.t$(5);break}return g.y(H,bVj(B.N,[A.entityKey]),5);case 5:g.Nc(H,3);break;case 2:return R=g.j_(H),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.HR&&R.type==="QUOTA_EXCEEDED"?(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):w7("Playlist add error"),H.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,Y,n));case 3:r=[];if(!B.NZ.B("html5_offline_prevent_redownload_downloaded_video")){H.t$(7);break}return g.y(H,EXh(B.N,"mainVideoEntity",V),8);case 8:V=H.U;case 7:if((d=V)==null?0:d.length)for(q=g.W(V),f=q.next();!f.done;f=q.next())if(h=f.value,P=h.offlineVideoData,N=void 0,(N=P)==null?0:N.videoId)K=void 0,p=Number(((K=A.actionMetadata)==null?void 0:K.priority)||
0)+1,r.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P.videoId,"mainVideoEntity",p,XO,L3V(A,P,c)));return H.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,r))}})},oOV=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E,e,F,x$,Va,Zx,a,rr,Qa,Y$,ug,fr,Lr,fa,ov,T2,nR,eF,Jb,dK,Lg,m5,tW,Ut,qF,Ou,qL,aZ,TS,mg,H1,sS,bF,Vm,Es,iM;
return g.u(function(hG){switch(hG.N){case 1:return x=Yf(A),w=A.entityKey,c=g.IY(w).entityId,V=[],Z=!1,c==="!*$_ALL_ENTITIES_!*$"?(Z=!0,g.y(hG,sc(B.N,"mainPlaylistEntity"),5)):g.y(hG,GI(B.N,w,"mainPlaylistEntity"),4);case 4:(R=hG.U)&&V.push(R);hG.t$(3);break;case 5:V=hG.U;case 3:if((Y=V)==null||!Y.length)return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));n=g.m(A.actionMetadata,b6_);d=(r=n)==null?void 0:r.nextAutoRefreshIntervalSeconds;f=(q=n)==null?void 0:q.autoSync;h=[];N=P=
!0;K=!1;if(!Z&&f===!1){hG.t$(6);break}g.Pp(hG,7);return g.y(hG,cP4(0,!!f,!0,V),9);case 9:h=hG.U;g.Nc(hG,8);break;case 7:p=g.j_(hG);if(!(p instanceof Error&&p.message==="No data")){p instanceof Error&&p.message==="Empty response body"&&w7(p.message);hG.t$(8);break}return c==="!*$_ALL_ENTITIES_!*$"?g.y(hG,MAW(B.N,A,B.S,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.y(hG,FlV(c,B.N,A,B.S),8);case 8:if(!h.length||!Z&&h[0].playlistId!==c)return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));case 6:if(Z){H=[];O=g.W(h);for(M=O.next();!M.done;M=O.next())t=M.value,t.upToDate||f&&!t.shouldAutoSyncMetadata||!t.playlistId||(v={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:f},H.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,XO,{mainPlaylistEntityActionMetadata:v})));return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,H))}h.length&&(cp=h[0],K=!!cp.upToDate,f&&(P=(S_=cp.shouldAutoSyncMetadata)!=null?S_:!0,N=(Bp=cp.shouldAutoSyncVideos)!=
null?Bp:!0,cp.checkInSeconds&&(d=cp.checkInSeconds)));if(K||!P)return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));L=[];z=V[0];if(!z.downloadState){I=void 0;hG.t$(15);break}return g.y(hG,GI(B.N,z.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:I=hG.U;case 15:return b=I,Nj=((Dx=b)==null?0:Dx.addedTimestampMillis)?String(b.addedTimestampMillis):void 0,g.Pp(hG,17),g.y(hG,mEr(B,c,Nj,d),19);case 19:L=hG.U;g.Nc(hG,18);break;case 17:Ao=g.j_(hG);if(!(Ao instanceof Error&&
Ao.message==="No data for playlist")){if(Ao instanceof Error&&Ao.message==="Empty response body for playlist")w7(Ao.message);else return pD="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ig="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ao instanceof g.HR&&Ao.type==="QUOTA_EXCEEDED"&&(pD="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ig="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,pD,ig));hG.t$(18);
break}return g.y(hG,FlV(c,B.N,A,B.S),18);case 18:if(!N)return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));wo=[];I7=new Map;if((k=L)==null?0:k.length)for(C=g.W(L),E=C.next();!E.done;E=C.next())e=E.value,F=e.offlineVideoData,x$=void 0,((x$=F)==null?0:x$.videoId)&&I7.set(F.videoId,F);Va=new Map;Zx=[];if((a=z)==null?0:(rr=a.videos)==null?0:rr.length)for(Qa=g.W(z.videos),Y$=Qa.next();!Y$.done;Y$=Qa.next())if(ug=Y$.value,fr=JSON.parse(g.IY(ug).entityId),Lr=fr.videoId)I7.has(Lr)?(Va.set(Lr,
I7.get(Lr)),I7.delete(Lr)):Zx.push(Lr);ov=Number(((fa=A.actionMetadata)==null?void 0:fa.priority)||0)+1;T2=g.W(I7.entries());for(nR=T2.next();!nR.done;nR=T2.next())eF=nR.value,Jb=g.W(eF),dK=Jb.next().value,Lg=Jb.next().value,m5=dK,tW=Lg,wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m5,"mainVideoEntity",ov,XO,L3V(A,tW,c)));Ut=g.W(Va.entries());for(qF=Ut.next();!qF.done;qF=Ut.next())Ou=qF.value,qL=g.W(Ou),aZ=qL.next().value,TS=qL.next().value,mg=aZ,H1=TS,wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
mg,"mainVideoEntity",ov,XO,L3V(A,H1,c)));sS=g.W(Zx);for(bF=sS.next();!bF.done;bF=sS.next())Vm=bF.value,Es={playlistId:c},iM={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Es},wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Vm,"mainVideoEntity",0,XO,iM));return hG.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,wo))}})},J3o=function(B,A){var x,w,c,V;
return g.u(function(Z){switch(Z.N){case 1:return x=Yf(A),g.Pp(Z,2),w=g.IY(A.entityKey).entityId,w==="!*$_ALL_ENTITIES_!*$"?g.y(Z,MAW(B.N,A,B.S,(c=A.actionMetadata)==null?void 0:(V=c.offlineLoggingData)==null?void 0:V.offlineDeleteReason),5):g.y(Z,FlV(w,B.N,A,B.S),6);case 6:if(!B.NZ.B("woffle_enable_main_downloads_library")){Z.t$(5);break}return g.y(Z,oXh(B.N,A.entityKey),5);case 5:g.Nc(Z,3);break;case 2:return g.j_(Z),Z.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},mEr=function(B,A,x,w){var c,V,Z,R,Y,n,r;
return g.u(function(d){switch(d.N){case 1:return g.y(d,xHW([A]),2);case 2:return c=d.U,g.y(d,vOc(B,c[0],x,w),3);case 3:return V=d.U,Z=V.mainPlaylistEntity,R=V.bh9,n=OVV(Z,(Y=R)==null?void 0:Y.avatar),g.Pp(d,4),g.y(d,UR(n),6);case 6:g.Nc(d,5);break;case 4:r=g.j_(d),r instanceof Error&&r.message==="Failed to fetch"&&w7(r.message);case 5:return d.return(c[0].videos)}})},vOc=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O;
return g.u(function(M){switch(M.N){case 1:c=Date.now().toString();x||(x=c);V=A.videos;Z=A.playlistId;R=[];Y=[];if(V)for(n=g.W(V),r=n.next();!r.done;r=n.next()){d=r.value;q=d.offlineVideoData;if(!q||!q.videoId)throw w7("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");f=q.videoId;h={videoId:f,playlistId:Z};P={id:g.$9(JSON.stringify(h),"mainPlaylistVideoEntity"),video:g.$9(f,"mainVideoEntity")};R.push(P);Y.push(P.id)}K={key:g.$9(Z,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:x,lastSyncedTimestampMillis:c};p={key:g.$9(Z,"mainPlaylistEntity"),playlistId:Z,videos:Y,title:A.title,thumbnailStyleData:XU8(A),visibility:zIj(A),downloadState:K.key};A.channel&&(H=A.channel.offlineChannelData,N=i6h(g.$9(Z,"ytMainChannelEntity"),H),p.channelOwner=N.id);((O=p)==null?0:O.entityMetadata)?(p.entityMetadata.offlineLastModifiedTimestampSeconds=A.lastModifiedTimestamp,w&&(p.entityMetadata.nextAutoRefreshIntervalSeconds=String(w))):p&&(p.entityMetadata={nextAutoRefreshIntervalSeconds:w?
String(w):void 0,offlineLastModifiedTimestampSeconds:A.lastModifiedTimestamp});g.Pp(M,2);return g.y(M,zI(B.N,{mode:"readwrite",Yb:!0},function(t){var v=oO(t,p,"mainPlaylistEntity"),cp=oO(t,K,"mainPlaylistDownloadStateEntity");v=[v,cp];cp=g.W(R);for(var S_=cp.next();!S_.done;S_=cp.next())v.push(oO(t,S_.value,"mainPlaylistVideoEntity"));N&&v.push(oO(t,N,"ytMainChannelEntity"));return g.M5.all(v)}),4);
case 4:g.Nc(M,3);break;case 2:throw g.j_(M),w7("PES failure for playlist"),Error("PES failure for playlist");case 3:return M.return({mainPlaylistEntity:p,bh9:N,BZR:R})}})},i6h=function(B,A){return{id:B,
channelId:A.channelId,title:A.title,avatar:A.thumbnail}},XU8=function(B){var A=[],x=B.videos;
x&&x.length>0&&A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:x[0].offlineVideoData.thumbnail}}});if((B=B.additionalMetadadatas)&&B.length>0)for(B=g.W(B),x=B.next();!x.done;x=B.next()){var w=x.value.offlineBundleItemPlaylistData,c=void 0;x=(c=w)==null?void 0:c.style;c=void 0;w={collageThumbnail:{coverThumbnail:(c=w)==null?void 0:c.coverThumbnail}};switch(x){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:w});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:w});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:w});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:w})}}return A},zIj=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},L3V=function(B,A,x){A={offlineVideoData:A,
playlistId:x};if(B=g.m(B.actionMetadata,b6_))A.maximumDownloadQuality=B.maximumDownloadQuality;return{mainVideoEntityActionMetadata:A}},Gd_=function(B,A,x){this.N=B;
this.NZ=A;this.S=x},BN4=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h;
return g.u(function(P){switch(P.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,V=g.m(A.actionMetadata,zl),R=!((Z=V)==null?0:Z.playlistId),g.Pp(P,2),g.y(P,sMc(B,c,void 0,(Y=V)==null?void 0:Y.offlineVideoData,R),4);case 4:g.Nc(P,3);break;case 2:return n=g.j_(P),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.HR&&n.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
P.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,r,d));case 3:q=1;q=Number(((f=A.actionMetadata)==null?void 0:f.priority)||0)+1;var N=(N=g.m(A.actionMetadata,zl))?{playbackDataActionMetadata:{maximumDownloadQuality:N.maximumDownloadQuality}}:void 0;h=ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"playbackData",q,DEV,N);return P.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,[h]))}})},Af8=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p;
return g.u(function(H){switch(H.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,g.y(H,GI(B.N,A.entityKey,"mainVideoEntity"),2);case 2:V=H.U;if(!V){Z=void 0;H.t$(3);break}return g.y(H,GI(B.N,V.downloadState,"mainVideoDownloadStateEntity"),4);case 4:Z=H.U;case 3:R=Z;if(!V||!R)return H.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.Pp(H,5);return g.y(H,sMc(B,c,R.addedTimestampMillis,(n=g.m(A.actionMetadata,zl))==null?void 0:n.offlineVideoData),7);case 7:r=1;r=Number(((d=
A.actionMetadata)==null?void 0:d.priority)||0)+1;Y=ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c,"playbackData",r,DEV);g.Nc(H,6);break;case 5:q=g.j_(H);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")w7(q.message);else return f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.HR&&q.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,f,h));H.t$(6);break}return g.y(H,kf(B.N,c),9);case 9:P=H.U;N=g.m(A.actionMetadata,zl);if(p=(K=N)==null?void 0:K.playlistId)P.playlistId=p;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.y(H,NN(c,B.N,A,B.S,P),6);case 6:return H.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,Y?[Y]:void 0))}})},xY4=function(B,A){var x,w,c,V,Z,R,Y,n,r,d;
return g.u(function(q){switch(q.N){case 1:return x=Yf(A),g.Pp(q,2),w=g.IY(A.entityKey).entityId,w==="!*$_ALL_ENTITIES_!*$"?g.y(q,MAW(B.N,A,B.S,(r=A.actionMetadata)==null?void 0:(d=r.offlineLoggingData)==null?void 0:d.offlineDeleteReason),5):g.y(q,kf(B.N,w),6);case 6:c=q.U;V=g.m(A.actionMetadata,zl);if(R=(Z=V)==null?void 0:Z.playlistId)c.playlistId=R;c.offlineDeleteReason=(Y=A.actionMetadata)==null?void 0:(n=Y.offlineLoggingData)==null?void 0:n.offlineDeleteReason;return g.y(q,NN(w,B.N,A,B.S,c),7);
case 7:if(!B.NZ.B("woffle_enable_main_downloads_library")){q.t$(5);break}return g.y(q,oXh(B.N,A.entityKey),5);case 5:g.Nc(q,3);break;case 2:return g.j_(q),q.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},sMc=function(B,A,x,w,c){var V,Z,R,Y,n,r;
return g.u(function(d){switch(d.N){case 1:if(V=w){d.t$(2);break}return g.y(d,APc([A]),3);case 3:Z=d.U,V=Z[0];case 2:return g.y(d,wlW(B,V,x,c),4);case 4:R=d.U;Y=R.mainVideoEntity;n=R.channelEntity;g.Pp(d,5);var q=Q$(Y.thumbnail),f=Q$(n.avatar);return g.y(d,UR(q.concat(f)),7);case 7:g.Nc(d,0);break;case 5:r=g.j_(d),r instanceof Error&&r.message==="Failed to fetch"&&w7(r.message),g.Wp(d)}})},wlW=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q,f,h,P,N;
return g.u(function(K){switch(K.N){case 1:x||(x=Date.now().toString());V=(c=A.channel)==null?void 0:c.offlineChannelData;Z={id:g.$9(A.videoId,"ytMainChannelEntity"),channelId:V.channelId,title:V.title,avatar:V.thumbnail};R={key:g.$9(A.videoId,"mainVideoDownloadStateEntity"),playbackData:g.$9(A.videoId,"playbackData"),addedTimestampMillis:x,videoDownloadContextEntity:g.$9(A.videoId,"videoDownloadContextEntity")};Y={key:g.$9(A.videoId,"videoPlaybackPositionEntity"),videoId:A.videoId,lastPlaybackPositionSeconds:"0"};
B.NZ.B("html5_offline_playback_position_sync")&&(n={playbackPosition:Y.key});r=g.$9(A.videoId,"mainVideoEntity");d={key:r,videoId:A.videoId,title:A.title,thumbnail:A.thumbnail,localizedStrings:{viewCount:A.shortViewCountText},userState:n,lengthSeconds:A.lengthSeconds?Number(A.lengthSeconds):void 0,publishedTimestampMillis:A.publishedTimestamp?(Number(A.publishedTimestamp)*1E3).toString():void 0,formattedDescription:A.description,owner:Z.id,downloadState:R.key};if(!B.NZ.B("woffle_enable_main_downloads_library")||
!w){K.t$(2);break}return g.y(K,tA7(B.N,[r]),3);case 3:if(h=K.U)q=h.mainDownloadsLibraryEntity,f=h.mainDownloadsListEntity;case 2:return N=pGh,P={key:g.$9(A.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.sh(R,N,P),g.y(K,zI(B.N,{mode:"readwrite",Yb:!0},function(p){var H=oO(p,Z,"ytMainChannelEntity"),O=oO(p,R,"mainVideoDownloadStateEntity"),M=oO(p,d,"mainVideoEntity");H=[H,O,M];B.NZ.B("html5_offline_playback_position_sync")&&(O=oO(p,Y,"videoPlaybackPositionEntity"),
H.push(O));q&&(O=oO(p,q,"mainDownloadsLibraryEntity"),H.push(O));f&&(O=oO(p,f,"mainDownloadsListEntity"),H.push(O));P&&(p=oO(p,P,"downloadStatusEntity"),H.push(p));return g.M5.all(H)}),4);
case 4:return K.return({mainVideoEntity:d,channelEntity:Z})}})},cf7=function(B,A,x){this.N=B;
this.NZ=A;this.S=x},ZxY=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z;
return g.u(function(I){switch(I.N){case 1:return x=Yf(A),w=[],g.y(I,lo.getInstance(),2);case 2:c=I.U;if(!c){I.t$(3);break}return g.y(I,c.get("sdois"),4);case 4:return V=I.U,g.y(I,(R=c)==null?void 0:R.get("lmqf"),5);case 5:Z=I.U;case 3:g.Pp(I,6);if(V===void 0)throw Error("prefStorage or opt-in state is undefined");Y=[];if(V){I.t$(8);break}return g.y(I,Llc(B.N),9);case 9:Y=I.U,Y.reverse();case 8:if(!Y.length){I.t$(10);break}n=g.W(Y);r=n.next();case 11:if(r.done){I.t$(10);break}d=r.value;if(!d){I.t$(12);
break}q=g.IY(d).entityId;return g.y(I,kf(B.N,q),14);case 14:return f=I.U,f.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.y(I,NN(q,B.N,{entityKey:d,actionType:A.actionType},B.S,f),12);case 12:r=n.next();I.t$(11);break;case 10:return g.y(I,ZI_(V,(h=Z)!=null?h:"SD"),16);case 16:return P=I.U,g.y(I,lI4(P),17);case 17:N=mz4(P);if(!B.NZ.B("woffle_enable_main_downloads_library")){I.t$(18);break}if(V){I.t$(19);break}return g.y(I,oXh(B.N,g.OU),19);case 19:return g.y(I,bVj(B.N,[g.OU]),18);
case 18:if((K=N)==null?0:K.length)for(p=g.W(N),H=p.next();!H.done;H=p.next())if(M=O=H.value,t=M.actionType,v=M.entityKey,cp=M.actionMetadata,t&&v&&cp&&!g.m(cp,V9o)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(cp.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(S_=g.m(O.actionMetadata,zl))S_.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",O.actionMetadata=Object.assign({},O.actionMetadata,{mainVideoEntityActionMetadata:S_});w.push(O)}g.Nc(I,7);break;
case 6:return Bp=g.j_(I),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Bp instanceof g.HR&&Bp.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,L,z));case 7:return I.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,w))}})},S5c=function(){J_.apply(this,arguments);
this.Z="mainVideoEntity"},R5Y=function(B,A,x){A=A===void 0?43200:A;
x=x===void 0?!0:x;var w=w===void 0?!1:w;var c,V,Z;return g.u(function(R){switch(R.N){case 1:if(!B.Y.PS())return R.return([]);c=[];g.Pp(R,2);return g.y(R,cP4(A,x,w),4);case 4:c=R.U;g.Nc(R,3);break;case 2:V=g.j_(R),V instanceof Error&&V.message==="No data"||V instanceof Error&&V.message==="Empty response body"&&w7(V.message);case 3:return Z=Mv8(B,c,x,"mainPlaylistEntity"),R.return(Z)}})},Y5_=function(B,A,x,w){w=w===void 0?!1:w;
var c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p;return g.u(function(H){switch(H.N){case 1:return c=[],g.y(H,Vnj(),2);case 2:return(V=H.U)||w?g.y(H,Sv_(A,x),3):H.return([]);case 3:Z=H.U;if((R=Z)==null||!R.length)return H.return([]);Y={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};n=g.W(Z);r=n.next();case 4:if(r.done){H.t$(6);break}q=d=r.value;f=q.actionType;h=q.entityKey;P=q.actionMetadata;if(!(f&&h&&P)||g.m(P,V9o)){H.t$(5);break}f==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(P.offlineLoggingData=
Y);N=g.IY(h);K=N.entityId;return g.y(H,vV(B,[K],"mainVideoEntity",f,P),8);case 8:p=H.U,c=c.concat(p);case 5:r=n.next();H.t$(4);break;case 6:return H.return(c)}})},nwo=function(B,A){this.N=B;
this.S=A},dYW=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K;
return g.u(function(p){switch(p.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,V=[],g.Pp(p,2),g.y(p,rfV(B,c),4);case 4:V=p.U;if((Z=V)==null||!Z.length){p.t$(5);break}return g.y(p,iVc(B.N,A.entityKey),5);case 5:g.Nc(p,3);break;case 2:return R=g.j_(p),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.HR&&R.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
p.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,Y,n));case 3:return r=[],g.y(p,EXh(B.N,"musicTrack",V),7);case 7:V=p.U;if(V.length)for(d=g.W(V),q=d.next();!q.done;q=d.next())if(f=q.value,h=f.offlineVideoData,P=void 0,(P=h)==null?0:P.videoId)N=void 0,K=Number(((N=A.actionMetadata)==null?void 0:N.priority)||0)+1,r.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",K,ir,ER(A,h,c)));return p.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,r))}})},
q5h=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E,e,F,x$,Va,Zx,a,rr,Qa,Y$,ug,fr,Lr,fa,ov,T2,nR,eF,Jb,dK,Lg;
return g.u(function(m5){switch(m5.N){case 1:return x=Yf(A),w=A.entityKey,c=g.IY(w).entityId,V=[],Z=!1,c==="!*$_ALL_ENTITIES_!*$"?(Z=!0,g.y(m5,sc(B.N,"musicAlbumRelease"),5)):g.y(m5,GI(B.N,w,"musicAlbumRelease"),4);case 4:(R=m5.U)&&V.push(R);m5.t$(3);break;case 5:V=m5.U;case 3:if((Y=V)==null||!Y.length)return m5.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));if(Z){n=[];r=g.W(V);for(d=r.next();!d.done;d=r.next())q=d.value,f=g.IY(q.id).entityId,n.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
f,"musicAlbumRelease",0,ir));return m5.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,n))}h=[];P=V[0];N=void 0;if(!P.downloadMetadata){m5.t$(6);break}return g.y(m5,GI(B.N,P.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:K=m5.U,N=Number((H=(p=K)==null?void 0:p.addedTimestampMillis)!=null?H:"0")/1E3;case 6:return g.Pp(m5,8),g.y(m5,rfV(B,c,(O=N)==null?void 0:O.toString()),10);case 10:h=m5.U;g.Nc(m5,9);break;case 8:M=g.j_(m5);if(!(M instanceof Error&&M.message===
"No data")){if(M instanceof Error&&M.message==="Empty response body")w7(M.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.HR&&M.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m5.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,t,v));m5.t$(9);break}return g.y(m5,CB(c,"musicAlbumRelease",B.N,
A,B.S),9);case 9:cp=[];S_=new Map;if((Bp=h)==null?0:Bp.length)for(L=g.W(h),z=L.next();!z.done;z=L.next())I=z.value,b=I.offlineVideoData,Dx=void 0,((Dx=b)==null?0:Dx.videoId)&&S_.set(b.videoId,b);Nj=new Map;Ao=[];if((pD=P)==null?0:(ig=pD.tracks)==null?0:ig.length)for(wo=g.W(P.tracks),I7=wo.next();!I7.done;I7=wo.next())if(k=I7.value,C=g.IY(k).entityId)S_.has(C)?(Nj.set(C,S_.get(C)),S_.delete(C)):Ao.push(C);e=Number(((E=A.actionMetadata)==null?void 0:E.priority)||0)+1;F=g.W(S_.entries());for(x$=F.next();!x$.done;x$=
F.next())Va=x$.value,Zx=g.W(Va),a=Zx.next().value,rr=Zx.next().value,Qa=a,Y$=rr,cp.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Qa,"musicTrack",e,ir,ER(A,Y$)));ug=g.W(Nj.entries());for(fr=ug.next();!fr.done;fr=ug.next())Lr=fr.value,fa=g.W(Lr),ov=fa.next().value,T2=fa.next().value,nR=ov,eF=T2,cp.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",nR,"musicTrack",e,ir,ER(A,eF)));Jb=g.W(Ao);for(dK=Jb.next();!dK.done;dK=Jb.next())Lg=dK.value,cp.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Lg,
"musicTrack",0,ir));return m5.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,cp))}})},fKj=function(B,A){var x,w;
return g.u(function(c){switch(c.N){case 1:return x=Yf(A),g.Pp(c,2),w=g.IY(A.entityKey).entityId,w==="!*$_ALL_ENTITIES_!*$"?g.y(c,pB(B.N,A,B.S),5):g.y(c,CB(w,"musicAlbumRelease",B.N,A,B.S),6);case 6:return g.y(c,GEc(B.N,A.entityKey),5);case 5:g.Nc(c,3);break;case 2:return g.j_(c),c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},rfV=function(B,A,x){var w,c,V;
return g.u(function(Z){switch(Z.N){case 1:return g.y(Z,xHW([A]),2);case 2:return w=Z.U,g.y(Z,h5Y(B,w[0],x),3);case 3:return c=Z.U,V=Q$(c.thumbnailDetails),g.y(Z,UR(V),4);case 4:return Z.return(w[0].videos)}})},h5Y=function(B,A,x){var w,c,V,Z,R,Y,n,r,d,q,f,h,P,N;
return g.u(function(K){if(K.N==1){w=A.additionalMetadadatas;c=void 0;if(w&&w.length>0)for(V=g.W(w),Z=V.next();!Z.done;Z=V.next())if(R=Z.value,R.offlineMusicPlaylistData){c=R.offlineMusicPlaylistData;break}Y=A.playlistId;n=s4r(A);r=n.TA;d=n.Fo;q=x?(Number(x)*1E3).toString():Date.now().toString();f=A.lastModifiedTimestamp?(Number(A.lastModifiedTimestamp)*1E3).toString():"0";h={id:g.$9(Y,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:d,lastModifiedTimestampMillis:f,addedTimestampMillis:q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};P={id:g.$9(Y,"musicAlbumRelease"),title:A.title,audioPlaylistId:Y,trackCount:A.totalVideoCount,tracks:r,downloadMetadata:h.id};c&&(P.thumbnailDetails=(N=c.albumHqThumbnail)!=null?N:c.albumArtistThumbnail,P.artistDisplayName=c.albumArtistDisplayName,P.releaseDate=c.albumReleaseDate,P.contentRating={explicitType:c.albumReleaseExplicitType},P.releaseType=c.albumReleaseType);return g.y(K,zI(B.N,{mode:"readwrite",Yb:!0},function(p){var H=oO(p,P,"musicAlbumRelease");
p=oO(p,h,"musicAlbumReleaseDownloadMetadataEntity");return g.M5.all([H,p])}),2)}return K.return(P)})},Qhr=function(B,A){this.N=B;
this.S=A},$YY=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K;
return g.u(function(p){switch(p.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,V=[],g.Pp(p,2),g.y(p,IKc(B,c),4);case 4:V=p.U;if((Z=V)==null||!Z.length){p.t$(5);break}return g.y(p,iVc(B.N,A.entityKey),5);case 5:g.Nc(p,3);break;case 2:return R=g.j_(p),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.HR&&R.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
p.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,Y,n));case 3:return r=[],g.y(p,EXh(B.N,"musicTrack",V),7);case 7:V=p.U;if(V.length)for(d=g.W(V),q=d.next();!q.done;q=d.next())if(f=q.value,h=f.offlineVideoData,P=void 0,(P=h)==null?0:P.videoId)N=void 0,K=Number(((N=A.actionMetadata)==null?void 0:N.priority)||0)+1,r.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",K,Gl,ER(A,h,c)));return p.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,r))}})},
WP7=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7,k,C,E,e,F,x$,Va,Zx,a,rr,Qa,Y$,ug,fr,Lr,fa,ov,T2,nR,eF,Jb,dK,Lg,m5,tW,Ut,qF,Ou,qL,aZ,TS,mg,H1,sS,bF;
return g.u(function(Vm){switch(Vm.N){case 1:return x=Yf(A),w=A.entityKey,c=g.IY(w).entityId,V=[],Z=!1,c==="!*$_ALL_ENTITIES_!*$"?(Z=!0,g.y(Vm,sc(B.N,"musicPlaylist"),5)):g.y(Vm,GI(B.N,w,"musicPlaylist"),4);case 4:(R=Vm.U)&&V.push(R);Vm.t$(3);break;case 5:V=Vm.U;case 3:if((Y=V)==null||!Y.length)return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));n=g.m(A.actionMetadata,Dzh);d=(r=n)==null?void 0:r.autoSync;q=[];h=f=!0;P=!1;N=void 0;if(!Z&&d===!1){Vm.t$(6);break}g.Pp(Vm,7);return g.y(Vm,
RPo(0,!!d,!0,V),9);case 9:q=Vm.U;g.Nc(Vm,8);break;case 7:K=g.j_(Vm);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&w7(K.message);Vm.t$(8);break}return c==="!*$_ALL_ENTITIES_!*$"?g.y(Vm,pB(B.N,A,B.S),8):g.y(Vm,CB(c,"musicPlaylist",B.N,A,B.S),8);case 8:if(!q.length||!Z&&q[0].playlistId!==c)return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));case 6:if(Z){p=[];H=g.W(q);for(O=H.next();!O.done;O=H.next())M=O.value,M.upToDate||
d&&!M.shouldAutoSyncMetadata||!M.playlistId||(t={autoSync:d},p.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M.playlistId,"musicPlaylist",0,Gl,{musicPlaylistEntityActionMetadata:t})));return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,p))}q.length&&(v=q[0],P=!!v.upToDate,d&&(f=(cp=v.shouldAutoSyncMetadata)!=null?cp:!0,h=(S_=v.shouldAutoSyncVideos)!=null?S_:!0,v.checkInSeconds&&(N=v.checkInSeconds)));if(P||!f)return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));Bp=[];L=V[0];z=void 0;if(!L.downloadMetadata){Vm.t$(15);break}return g.y(Vm,GI(B.N,L.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:I=Vm.U,z=Number((Dx=(b=I)==null?void 0:b.addedTimestampMillis)!=null?Dx:"0")/1E3;case 15:return g.Pp(Vm,17),g.y(Vm,IKc(B,c,(Nj=z)==null?void 0:Nj.toString(),N),19);case 19:Bp=Vm.U;g.Nc(Vm,18);break;case 17:Ao=g.j_(Vm);if(!(Ao instanceof Error&&Ao.message==="No data")){if(Ao instanceof Error&&Ao.message==="Empty response body")w7(Ao.message);else return pD=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ig="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ao instanceof g.HR&&Ao.type==="QUOTA_EXCEEDED"&&(pD="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ig="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,pD,ig));Vm.t$(18);break}return g.y(Vm,CB(c,"musicPlaylist",B.N,A,B.S),18);case 18:if(!h)return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));wo=[];I7=new Map;if((k=Bp)==null?0:k.length)for(C=g.W(Bp),E=C.next();!E.done;E=C.next())e=E.value,F=e.offlineVideoData,x$=void 0,((x$=F)==null?0:x$.videoId)&&I7.set(F.videoId,F);Va=new Map;Zx=[];if((a=L)==null?0:(rr=a.tracks)==null?0:rr.length)for(Qa=g.W(L.tracks),Y$=Qa.next();!Y$.done;Y$=Qa.next())if(ug=Y$.value,fr=g.IY(ug).entityId)I7.has(fr)?(Va.set(fr,I7.get(fr)),I7.delete(fr)):Zx.push(fr);fa=Number(((Lr=A.actionMetadata)==null?void 0:Lr.priority)||0)+1;ov=g.W(I7.entries());for(T2=ov.next();!T2.done;T2=
ov.next())nR=T2.value,eF=g.W(nR),Jb=eF.next().value,dK=eF.next().value,Lg=Jb,m5=dK,wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Lg,"musicTrack",fa,Gl,ER(A,m5)));tW=g.W(Va.entries());for(Ut=tW.next();!Ut.done;Ut=tW.next())qF=Ut.value,Ou=g.W(qF),qL=Ou.next().value,aZ=Ou.next().value,TS=qL,mg=aZ,wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",TS,"musicTrack",fa,Gl,ER(A,mg)));H1=g.W(Zx);for(sS=H1.next();!sS.done;sS=H1.next())bF=sS.value,wo.push(ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
bF,"musicTrack",0,Gl));return Vm.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,wo))}})},Pu7=function(B,A){var x,w;
return g.u(function(c){switch(c.N){case 1:return x=Yf(A),g.Pp(c,2),w=g.IY(A.entityKey).entityId,w==="!*$_ALL_ENTITIES_!*$"?g.y(c,pB(B.N,A,B.S),5):g.y(c,CB(w,"musicPlaylist",B.N,A,B.S),6);case 6:return g.y(c,GEc(B.N,A.entityKey),5);case 5:g.Nc(c,3);break;case 2:return g.j_(c),c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},IKc=function(B,A,x,w){var c,V,Z;
return g.u(function(R){switch(R.N){case 1:return g.y(R,xHW([A]),2);case 2:return c=R.U,g.y(R,UYh(B,c[0],x,w),3);case 3:return V=R.U,Z=Q$(V.thumbnailDetails),g.y(R,UR(Z),4);case 4:return R.return(c[0].videos)}})},UYh=function(B,A,x,w){var c,V,Z,R,Y,n,r,d,q;
return g.u(function(f){return f.N==1?(c=A.playlistId,V=s4r(A),Z=V.TA,R=V.Fo,Y=x?(Number(x)*1E3).toString():Date.now().toString(),n=A.lastModifiedTimestamp?(Number(A.lastModifiedTimestamp)*1E3).toString():"0",r={id:g.$9(c,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:R,lastModifiedTimestampMillis:n,addedTimestampMillis:Y,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},d={id:g.$9(c,"musicPlaylist"),title:A.title,playlistId:c,thumbnailDetails:A.thumbnail,visibility:NNr(A),trackCount:A.totalVideoCount,
tracks:Z,downloadMetadata:r.id},w&&(((q=d)==null?0:q.entityMetadata)?d.entityMetadata.nextAutoRefreshIntervalSeconds=String(w):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:String(w)})),g.y(f,zI(B.N,{mode:"readwrite",Yb:!0},function(h){var P=oO(h,d,"musicPlaylist");h=oO(h,r,"musicPlaylistDownloadMetadataEntity");return g.M5.all([P,h])}),2)):f.return(d)})},NNr=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},jhW=function(B,A){this.N=B;
this.S=A},plj=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h;
return g.u(function(P){switch(P.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,V=g.m(A.actionMetadata,kOj),g.Pp(P,2),g.y(P,KPr(B,c,void 0,(Z=V)==null?void 0:Z.track,(R=V)==null?void 0:R.albumRelease),4);case 4:if((Y=V)==null?0:Y.playlistId){P.t$(5);break}return g.y(P,iVc(B.N,A.entityKey),5);case 5:g.Nc(P,3);break;case 2:return n=g.j_(P),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.HR&&n.type==="QUOTA_EXCEEDED"&&
(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,r,d));case 3:f=Number(((q=A.actionMetadata)==null?void 0:q.priority)||0)+1;var N=(N=g.m(A.actionMetadata,kOj))?{playbackDataActionMetadata:{maximumDownloadQuality:N.maximumDownloadQuality}}:void 0;h=ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"playbackData",f,Cur,N);return P.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x,[h]))}})},Ew4=function(B,A){var x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N;
return g.u(function(K){switch(K.N){case 1:return x=Yf(A),w=g.IY(A.entityKey),c=w.entityId,g.y(K,GI(B.N,A.entityKey,"musicTrack"),2);case 2:V=K.U;if(!V){Z=void 0;K.t$(3);break}return g.y(K,GI(B.N,V.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:Z=K.U;case 3:R=Z;if(!V||!R)return K.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));n=g.m(A.actionMetadata,kOj);g.Pp(K,5);return g.y(K,KPr(B,c,R.addedTimestampMillis,(r=n)==null?void 0:r.track,(d=n)==null?void 0:d.albumRelease),
7);case 7:f=Number(((q=A.actionMetadata)==null?void 0:q.priority)||0)+1;Y=ew("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c,"playbackData",f,Cur);g.Nc(K,6);break;case 5:h=g.j_(K);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof Error&&h.message==="Empty response body")w7(h.message);else return P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.HR&&h.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),K.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,P,N));K.t$(6);break}return g.y(K,KB(c,B.N,A,B.S),6);case 6:return K.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,Y?[Y]:void 0))}})},yfr=function(B,A){var x,w;
return g.u(function(c){switch(c.N){case 1:return x=Yf(A),g.Pp(c,2),w=g.IY(A.entityKey).entityId,w==="!*$_ALL_ENTITIES_!*$"?g.y(c,pB(B.N,A,B.S),5):g.y(c,KB(w,B.N,A,B.S),6);case 6:return g.y(c,GEc(B.N,A.entityKey),5);case 5:g.Nc(c,3);break;case 2:return g.j_(c),c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new OR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},KPr=function(B,A,x,w,c){var V,Z,R,Y,n,r;
return g.u(function(d){switch(d.N){case 1:if(V=w){d.t$(2);break}return g.y(d,APc([A]),3);case 3:Z=d.U,R=Z[0],V=zvc(R);case 2:return g.y(d,Hxo(B,V,A,c,x),4);case 4:Y=d.U;n=Y.musicTrackEntity;r=Y.vK;var q=Q$(n.thumbnailDetails),f=[];r&&(f=Q$(r.thumbnailDetails));return g.y(d,UR(q.concat(f)),0)}})},Hxo=function(B,A,x,w,c){var V;
return g.u(function(Z){return Z.N==1?(c||(c=Date.now().toString()),V={id:g.$9(x,"musicTrackDownloadMetadataEntity"),playbackData:g.$9(x,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.$9(x,"videoDownloadContextEntity")},w&&(A.albumRelease=w.id),g.y(Z,zI(B.N,{mode:"readwrite",Yb:!0},function(R){var Y=[],n=oO(R,V,"musicTrackDownloadMetadataEntity");Y.push(n);n=oO(R,A,"musicTrack");Y.push(n);w&&(R=oO(R,w,"musicAlbumRelease"),Y.push(R));return g.M5.all(Y)}),2)):Z.N!=3?g.y(Z,qN(x,"musicTrackDownloadMetadataEntity",
B.N,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):Z.return({musicTrackEntity:A,
vK:w})})},sR=function(){J_.apply(this,arguments);
this.Z="musicTrack"},uVo=function(B,A,x){A=A===void 0?43200:A;
x=x===void 0?!0:x;var w=w===void 0?!1:w;var c,V;return g.u(function(Z){switch(Z.N){case 1:if(!B.Y.PS())return Z.return([]);c=[];g.Pp(Z,2);return g.y(Z,RPo(A,x,w),4);case 4:c=Z.U;g.Nc(Z,3);break;case 2:g.j_(Z);case 3:return V=Mv8(B,c,x,"musicPlaylist"),Z.return(V)}})},e57=function(){g.Ey.apply(this,arguments);
var B=this;this.events=new g.be(this);this.NZ=this.player.C();this.v3={dmR:function(){return B.N},
J8:function(){return B.J8()},
Ga:function(A){return B.Ga(A)}}},Ox4=function(B){var A;
B=g.m((A=B.getWatchNextResponse())==null?void 0:A.currentVideoEndpoint,g.sH);if(B==null?0:B.playlistId)var x=B.playlistId;return x},aK0=function(B,A){var x,w,c,V;
return g.u(function(Z){if(Z.N==1){x=A.clientPlaybackNonce;w={cpn:x,offlineSourceVisualElement:g.aJ(A.fF||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};A.U&&(w.videoFmt=Number(A.U.itag));A.D&&(w.audioFmt=Number(A.D.itag));if((c=Ox4(A))&&A.videoId){var R=A.videoId;R=c!=="PPSV"?Promise.resolve(!1):B.N.hT(R);Z=g.y(Z,R,3)}else Z=Z.t$(2);return Z}Z.N!=2&&(V=Z.U)&&(w.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");B.U=x;g.jr("offlinePlaybackStarted",w);g.Wp(Z)})};
g.KE.prototype.wJ=g.wr(45,function(B){return this.app.wJ(B)});
g.WZ.prototype.wJ=g.wr(44,function(B){return g.PZ(this,9,B)});
g.Q(gh,FL);g.Rv.Object.defineProperties(gh.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.N.entityMetadata},
set:function(B){this.N.entityMetadata=B}}});
g.Q(eLh,gh);eLh.prototype.U=function(){return[]};
g.Q(OMY,gh);OMY.prototype.U=function(){return[]};
g.Q(aGh,gh);aGh.prototype.U=function(){return[]};
g.Q(F0W,gh);F0W.prototype.U=function(){return[]};
g.Q(gGo,gh);gGo.prototype.U=function(){var B=[];this.N.alternateChannel&&B.push(this.N.alternateChannel);this.N.alternateChannelList&&B.push.apply(B,g.U(this.N.alternateChannelList));this.N.oneofChannelEntity&&B.push(this.N.oneofChannelEntity);return[].concat(g.U(new Set(B)))};
g.Q(MSW,gh);MSW.prototype.U=function(){var B=[];this.N.entryCollection&&B.push(this.N.entryCollection);return[].concat(g.U(new Set(B)))};
g.Q(lGr,FL);lGr.prototype.U=function(){var B=[];this.N.video&&B.push(this.N.video);return[].concat(g.U(new Set(B)))};
g.Q(T$4,gh);T$4.prototype.U=function(){var B=[];this.N.parentPlaylist&&B.push(this.N.parentPlaylist);if(this.N.entries)for(var A=g.W(this.N.entries),x=A.next();!x.done;x=A.next())B.push.apply(B,g.U((new lGr(x.value)).U()));return[].concat(g.U(new Set(B)))};
g.Q(mlj,gh);mlj.prototype.U=function(){var B=[];this.N.descriptionEntity&&B.push(this.N.descriptionEntity);this.N.creators&&B.push.apply(B,g.U(this.N.creators));this.N.theBiggestFan&&B.push(this.N.theBiggestFan);return[].concat(g.U(new Set(B)))};
g.Q(L0o,gh);L0o.prototype.U=function(){return[]};
g.Q(tSc,gh);tSc.prototype.U=function(){return[]};
g.Q(bMo,gh);bMo.prototype.U=function(){return[]};
g.Q(oGr,gh);oGr.prototype.U=function(){return[]};
g.Q(J07,gh);J07.prototype.U=function(){return[]};
g.Q(vG0,gh);vG0.prototype.U=function(){return[]};
g.Q(X1j,gh);X1j.prototype.U=function(){return[]};
g.Q(zL_,gh);zL_.prototype.U=function(){return[]};
g.Q(iMV,gh);iMV.prototype.U=function(){return[]};
g.Q(GR7,gh);GR7.prototype.U=function(){var B=[];this.N.downloadsList&&B.push(this.N.downloadsList);this.N.smartDownloadsList&&B.push(this.N.smartDownloadsList);this.N.recommendedDownloadsList&&B.push(this.N.recommendedDownloadsList);this.N.refresh&&B.push(this.N.refresh);return[].concat(g.U(new Set(B)))};
g.Q(swj,FL);swj.prototype.U=function(){var B=[];this.N.video&&B.push(this.N.video);this.N.playlist&&B.push(this.N.playlist);this.N.videoItem&&B.push(this.N.videoItem);this.N.playlistItem&&B.push(this.N.playlistItem);return[].concat(g.U(new Set(B)))};
g.Q(Dl0,gh);Dl0.prototype.U=function(){var B=[];this.N.refresh&&B.push(this.N.refresh);if(this.N.downloads)for(var A=g.W(this.N.downloads),x=A.next();!x.done;x=A.next())B.push.apply(B,g.U((new swj(x.value)).U()));return[].concat(g.U(new Set(B)))};
g.Q(BHh,gh);BHh.prototype.U=function(){var B=[];this.N.localImageEntities&&B.push.apply(B,g.U(this.N.localImageEntities));return[].concat(g.U(new Set(B)))};
g.Q(AZ_,gh);AZ_.prototype.U=function(){var B=[];this.N.playbackData&&B.push(this.N.playbackData);this.N.localImageEntities&&B.push.apply(B,g.U(this.N.localImageEntities));this.N.videoDownloadContextEntity&&B.push(this.N.videoDownloadContextEntity);return[].concat(g.U(new Set(B)))};
g.Q(xao,gh);xao.prototype.U=function(){return[]};
g.Q(wqV,gh);wqV.prototype.U=function(){var B=[];this.N.fakeChildren&&B.push.apply(B,g.U(this.N.fakeChildren));return[].concat(g.U(new Set(B)))};
g.Q(cZ8,gh);cZ8.prototype.U=function(){var B=[];this.N.video&&B.push(this.N.video);this.N.playbackData&&B.push(this.N.playbackData);this.N.offlineVideoPolicy&&B.push(this.N.offlineVideoPolicy);return[].concat(g.U(new Set(B)))};
g.Q(Vs7,gh);Vs7.prototype.U=function(){return[]};
g.Q(Znj,gh);Znj.prototype.U=function(){var B=[];this.N.channelOwner&&B.push(this.N.channelOwner);this.N.videos&&B.push.apply(B,g.U(this.N.videos));this.N.collaboratorChannels&&B.push.apply(B,g.U(this.N.collaboratorChannels));this.N.downloadState&&B.push(this.N.downloadState);this.N.refresh&&B.push(this.N.refresh);return[].concat(g.U(new Set(B)))};
g.Q(SAh,gh);SAh.prototype.U=function(){var B=[];this.N.video&&B.push(this.N.video);this.N.channelContributor&&B.push(this.N.channelContributor);return[].concat(g.U(new Set(B)))};
g.Q(ROh,FL);ROh.prototype.U=function(){var B=[];this.N.localImageEntities&&B.push.apply(B,g.U(this.N.localImageEntities));this.N.videoDownloadContextEntity&&B.push(this.N.videoDownloadContextEntity);return[].concat(g.U(new Set(B)))};
g.Q(YAh,FL);YAh.prototype.U=function(){var B=[];this.N.recommendedVideoMetadata&&B.push.apply(B,g.U((new ROh(this.N.recommendedVideoMetadata)).U()));return[].concat(g.U(new Set(B)))};
g.Q(nI0,FL);nI0.prototype.U=function(){var B=[];this.N.playbackPosition&&B.push(this.N.playbackPosition);return[].concat(g.U(new Set(B)))};
g.Q(rZh,gh);rZh.prototype.U=function(){var B=[];this.N.owner&&B.push(this.N.owner);this.N.downloadState&&B.push(this.N.downloadState);this.N.userState&&B.push.apply(B,g.U((new nI0(this.N.userState)).U()));this.N.additionalMetadata&&B.push.apply(B,g.U((new YAh(this.N.additionalMetadata)).U()));return[].concat(g.U(new Set(B)))};
g.Q(dar,gh);dar.prototype.U=function(){var B=[];this.N.userChannelDetails&&B.push(this.N.userChannelDetails);return[].concat(g.U(new Set(B)))};
g.Q(qAr,gh);qAr.prototype.U=function(){var B=[];this.N.channelOwner&&B.push(this.N.channelOwner);this.N.playbackPosition&&B.push(this.N.playbackPosition);this.N.localImageEntities&&B.push.apply(B,g.U(this.N.localImageEntities));this.N.downloadStatus&&B.push(this.N.downloadStatus);return[].concat(g.U(new Set(B)))};
g.Q(fmV,gh);fmV.prototype.U=function(){return[]};
g.Q(hOr,gh);hOr.prototype.U=function(){return[]};
g.Q(Qc4,gh);Qc4.prototype.U=function(){return[]};
g.Q(Imj,gh);Imj.prototype.U=function(){return[]};
g.Q($ao,gh);$ao.prototype.U=function(){return[]};
g.Q(Wgc,gh);Wgc.prototype.U=function(){return[]};
g.Q(PsW,gh);PsW.prototype.U=function(){return[]};
g.Q(Uah,gh);Uah.prototype.U=function(){return[]};
g.Q(NH7,gh);NH7.prototype.U=function(){return[]};
g.Q(jco,gh);jco.prototype.U=function(){return[]};
g.Q(kSY,gh);kSY.prototype.U=function(){var B=[];this.N.trackDownloadMetadatas&&B.push.apply(B,g.U(this.N.trackDownloadMetadatas));return[].concat(g.U(new Set(B)))};
g.Q(KgV,gh);
KgV.prototype.U=function(){var B=[];this.N.downloadedTracks&&B.push.apply(B,g.U(this.N.downloadedTracks));this.N.smartDownloadedTracks&&B.push.apply(B,g.U(this.N.smartDownloadedTracks));this.N.downloadedEpisodes&&B.push.apply(B,g.U(this.N.downloadedEpisodes));this.N.downloadedAlbumReleases&&B.push.apply(B,g.U(this.N.downloadedAlbumReleases));this.N.smartDownloadedAlbumReleases&&B.push.apply(B,g.U(this.N.smartDownloadedAlbumReleases));this.N.downloadedPlaylists&&B.push.apply(B,g.U(this.N.downloadedPlaylists));this.N.smartDownloadedPlaylists&&
B.push.apply(B,g.U(this.N.smartDownloadedPlaylists));this.N.metadataOnlyTracks&&B.push.apply(B,g.U(this.N.metadataOnlyTracks));return[].concat(g.U(new Set(B)))};
g.Q(Cs7,gh);Cs7.prototype.U=function(){var B=[];this.N.trackDownloadMetadatas&&B.push.apply(B,g.U(this.N.trackDownloadMetadatas));return[].concat(g.U(new Set(B)))};
g.Q(pqr,gh);pqr.prototype.U=function(){var B=[];this.N.playbackData&&B.push(this.N.playbackData);this.N.localImageEntities&&B.push.apply(B,g.U(this.N.localImageEntities));this.N.videoDownloadContextEntity&&B.push(this.N.videoDownloadContextEntity);return[].concat(g.U(new Set(B)))};
g.Q(EIr,gh);EIr.prototype.U=function(){var B=[];this.N.musicLibraryStatusEntity&&B.push(this.N.musicLibraryStatusEntity);this.N.primaryArtists&&B.push.apply(B,g.U(this.N.primaryArtists));this.N.details&&B.push(this.N.details);this.N.userDetails&&B.push(this.N.userDetails);this.N.tracks&&B.push.apply(B,g.U(this.N.tracks));this.N.share&&B.push(this.N.share);this.N.downloadMetadata&&B.push(this.N.downloadMetadata);this.N.refresh&&B.push(this.N.refresh);return[].concat(g.U(new Set(B)))};
g.Q(yZh,gh);yZh.prototype.U=function(){var B=[];this.N.albumRelease&&B.push(this.N.albumRelease);this.N.tracks&&B.push.apply(B,g.U(this.N.tracks));return[].concat(g.U(new Set(B)))};
g.Q(Hno,gh);Hno.prototype.U=function(){var B=[];this.N.albumRelease&&B.push(this.N.albumRelease);return[].concat(g.U(new Set(B)))};
g.Q(un0,gh);un0.prototype.U=function(){var B=[];this.N.details&&B.push(this.N.details);this.N.userDetails&&B.push(this.N.userDetails);return[].concat(g.U(new Set(B)))};
g.Q(eOo,gh);eOo.prototype.U=function(){var B=[];this.N.parentArtist&&B.push(this.N.parentArtist);return[].concat(g.U(new Set(B)))};
g.Q(Onr,gh);Onr.prototype.U=function(){var B=[];this.N.parentArtist&&B.push(this.N.parentArtist);return[].concat(g.U(new Set(B)))};
g.Q(amo,gh);amo.prototype.U=function(){return[]};
g.Q(Fg4,gh);Fg4.prototype.U=function(){return[]};
g.Q(gIc,FL);gIc.prototype.U=function(){var B=[];this.N.creatorEntity&&B.push(this.N.creatorEntity);return[].concat(g.U(new Set(B)))};
g.Q(Ms7,gh);
Ms7.prototype.U=function(){var B=[];this.N.tracks&&B.push.apply(B,g.U(this.N.tracks));this.N.refresh&&B.push(this.N.refresh);this.N.musicLibraryStatusEntity&&B.push(this.N.musicLibraryStatusEntity);this.N.details&&B.push(this.N.details);this.N.downloadMetadata&&B.push(this.N.downloadMetadata);this.N.sideloadMetadata&&B.push(this.N.sideloadMetadata);this.N.userDetails&&B.push(this.N.userDetails);this.N.entryCollection&&B.push(this.N.entryCollection);this.N.share&&B.push(this.N.share);this.N.podcastShowAdditionalMetadata&&B.push.apply(B,
g.U((new gIc(this.N.podcastShowAdditionalMetadata)).U()));return[].concat(g.U(new Set(B)))};
g.Q(lm0,gh);lm0.prototype.U=function(){return[]};
g.Q(THh,gh);
THh.prototype.U=function(){var B=[];this.N.musicLibraryStatusEntity&&B.push(this.N.musicLibraryStatusEntity);this.N.artists&&B.push.apply(B,g.U(this.N.artists));this.N.audioModeVersion&&B.push(this.N.audioModeVersion);this.N.videoModeVersion&&B.push(this.N.videoModeVersion);this.N.userDetails&&B.push(this.N.userDetails);this.N.details&&B.push(this.N.details);this.N.albumRelease&&B.push(this.N.albumRelease);this.N.share&&B.push(this.N.share);this.N.libraryEdit&&B.push(this.N.libraryEdit);this.N.downloadMetadata&&
B.push(this.N.downloadMetadata);this.N.playbackPosition&&B.push(this.N.playbackPosition);this.N.lyrics&&B.push(this.N.lyrics);return[].concat(g.U(new Set(B)))};
g.Q(ma0,gh);ma0.prototype.U=function(){var B=[];this.N.parentTrack&&B.push(this.N.parentTrack);return[].concat(g.U(new Set(B)))};
g.Q(Lgr,gh);Lgr.prototype.U=function(){var B=[];this.N.parentTrack&&B.push(this.N.parentTrack);return[].concat(g.U(new Set(B)))};
g.Q(tsW,gh);tsW.prototype.U=function(){return[]};
g.Q(bnc,gh);bnc.prototype.U=function(){return[]};
g.Q(oIV,gh);oIV.prototype.U=function(){return[]};
g.Q(JZo,gh);JZo.prototype.U=function(){return[]};
g.Q(vI4,gh);vI4.prototype.U=function(){var B=[];this.N.transfer&&B.push(this.N.transfer);this.N.adsPlaybackData&&B.push.apply(B,g.U(this.N.adsPlaybackData));this.N.drmLicense&&B.push(this.N.drmLicense);this.N.offlineVideoPolicy&&B.push(this.N.offlineVideoPolicy);this.N.videoDownloadContextEntity&&B.push(this.N.videoDownloadContextEntity);return[].concat(g.U(new Set(B)))};
g.Q(Xqc,gh);Xqc.prototype.U=function(){return[]};
g.Q(zOr,gh);zOr.prototype.U=function(){var B=[];this.N.offlineVideoStreams&&B.push.apply(B,g.U(this.N.offlineVideoStreams));this.N.captionTrack&&B.push.apply(B,g.U(this.N.captionTrack));return[].concat(g.U(new Set(B)))};
g.Q(inr,gh);inr.prototype.U=function(){return[]};
g.Q(GSr,gh);GSr.prototype.U=function(){return[]};
g.Q(scY,gh);scY.prototype.U=function(){return[]};
g.Q(Dao,gh);Dao.prototype.U=function(){return[]};
g.Q(Bqo,gh);Bqo.prototype.U=function(){return[]};
g.Q(A6Y,gh);A6Y.prototype.U=function(){return[]};
g.Q(xbY,gh);xbY.prototype.U=function(){return[]};
g.Q(wXW,gh);wXW.prototype.U=function(){return[]};
g.Q(c6_,gh);c6_.prototype.U=function(){return[]};
g.Q(VLW,gh);VLW.prototype.U=function(){return[]};
g.Q(Z70,gh);Z70.prototype.U=function(){return[]};
g.Q(SWh,gh);SWh.prototype.U=function(){return[]};
g.Q(R4j,gh);R4j.prototype.U=function(){return[]};
g.Q(YW7,gh);YW7.prototype.U=function(){return[]};
g.Q(nB7,gh);nB7.prototype.U=function(){return[]};
g.Q(r6r,gh);r6r.prototype.U=function(){return[]};
g.Q(db8,gh);db8.prototype.U=function(){return[]};
var Yvr=["browse","music/browse","unplugged/browse"],fd4=["offline/playlist_sync_check"],BQr=["offline"],npc=["offline/offline_video_playback_position_sync"],dHY=["offline/get_playback_data_entity"],Mx;lo.getInstance=function(){return g.u(function(B){return B.return(new Promise(function(A){g.dF().then(function(x){x?(lo.instance||(lo.instance=new lo(x)),A(lo.instance)):A(void 0)})}))})};
lo.prototype.get=function(B){var A=this,x,w,c;return g.u(function(V){if(V.N==1)return g.y(V,Qbr(A.token),2);if(V.N!=3)return x=V.U,g.y(V,x.get("prefs",B),3);w=V.U;if(!w)return V.return();c=(0,g.Lk)();return w.expirationTimestampMs<=c?V.return():V.return(w.value)})};
lo.prototype.set=function(B,A,x){x=x===void 0?31536E3:x;var w=this,c,V,Z;return g.u(function(R){if(R.N==1)return c=(0,g.Lk)(),V={key:B,value:A,expirationTimestampMs:c+x*1E3},g.y(R,Qbr(w.token),2);Z=R.U;return g.y(R,g.Xs(Z,"prefs",V),0)})};
lo.prototype.remove=function(B){var A=this,x;return g.u(function(w){if(w.N==1)return g.y(w,Qbr(A.token),2);x=w.U;return g.y(w,x.delete("prefs",B),0)})};
g.Q(TI,g.Sr);g.Q(mj,Ub8);mj.prototype.S=function(B,A){A=jbc(A);B=(new TextEncoder).encode(JSON.stringify(B));return this.N.encrypt(B,A)};
mj.prototype.U=function(B,A){if(!(B instanceof Uint8Array))throw Iyr(1);var x=new TextDecoder;A=jbc(A);B=this.N.decrypt(B,A);return JSON.parse(x.decode(B))};
var k1o={accountLinkStatusEntity:bMo,booleanEntity:aGh,buttonEntity:VLW,captionTrack:tsW,channelHandle:eLh,commerceAcquisitionClientPayloadEntity:SWh,commerceCartListEntity:R4j,contextNoteFeedEntityPayload:OMY,continuationTokenEntity:Vs7,downloadQualityPickerEntity:X1j,downloadsPageRefreshTokenEntity:iMV,downloadsPageViewConfigurationEntity:fmV,downloadStatusEntity:zL_,sfvAudioItemCurrentlyPlayingEntity:GSr,emojiFountainDataEntity:wXW,emojiCustomizationSetEntity:xbY,fakeChannel:gGo,fakePlaylist:MSW,
fakePlaylistEntryCollection:T$4,fakeVideo:mlj,fakeVideoDescription:L0o,featuredProductsEntity:Uah,flowStateEntity:tSc,iconBadgeEntity:YW7,interstitialInteractionStateEntity:J07,liveChatPollStateEntity:vG0,liveReactionsDataEntity:c6_,logoEntity:oGr,macroMarkerEntity:hOr,mainDownloadsLibraryEntity:GR7,mainDownloadsListEntity:Dl0,mainPlaylistDownloadStateEntity:BHh,mainPlaylistEntity:Znj,mainPlaylistVideoEntity:SAh,mainVideoDownloadStateEntity:AZ_,mainVideoEntity:rZh,markersEngagementPanelSyncEntity:Qc4,
markersVisibilityOverrideEntity:Imj,musicAlbumReleaseDetail:yZh,musicAlbumReleaseDownloadMetadataEntity:kSY,musicAlbumRelease:EIr,musicAlbumReleaseUserDetail:Hno,musicArtistDetail:eOo,musicArtist:un0,musicArtistUserDetail:Onr,musicDownloadsLibraryEntity:KgV,musicLibraryEdit:amo,musicLibraryStatusEntity:Fg4,musicPlaylist:Ms7,musicPlaylistDownloadMetadataEntity:Cs7,musicShare:lm0,musicTrackDetail:ma0,musicTrackDownloadMetadataEntity:pqr,musicTrack:THh,musicTrackUserDetail:Lgr,offlineOrchestrationActionWrapperEntity:bnc,
offlineVideoPolicy:oIV,offlineVideoStreams:JZo,offlineabilityEntity:xao,orchestrationWebSamplingEntity:wqV,pageHeaderEntity:Bqo,pdpStateEntity:nB7,pinnedProductEntity:NH7,playbackData:vI4,playerStateEntity:$ao,quantityIncrementerEntity:r6r,refresh:Xqc,saveToPlaylistListEntity:scY,settingEntity:Dao,stringEntity:F0W,suggestedFeedbackChipStateEntity:Wgc,transfer:zOr,trendingOfferEntity:jco,videoDownloadContextEntity:inr,videoOverviewAsyncDataEntity:db8,videoPlaybackPositionEntity:Z70,votingEntity:A6Y,
ytMainChannelEntity:dar,youchatPendingResponseEntity:PsW,ytMainDownloadedVideoEntity:cZ8,ytMainVideoEntity:qAr};g.Q(vx,Ub8);vx.prototype.S=function(B){return B};
vx.prototype.U=function(B){if(B instanceof Uint8Array)throw Iyr(0);return B};
g.Q(XL,g.l);XL.prototype.observe=function(B){var A=this;this.observers.push(B);return function(){var x=A.observers.indexOf(B);x>=0&&A.observers.splice(x,1)}};
XL.prototype.U=function(B){lyc(this,B.data)};
XL.prototype.vR=function(){this.channel.close()};
var b7j,TBV=new g.mV("elementsCommand");var jw=new g.mV("entityBatchUpdate");var pGh=new g.mV("downloadStatusEntity");var b6_=new g.mV("mainPlaylistEntityActionMetadata");var zl=new g.mV("mainVideoEntityActionMetadata");var Dzh=new g.mV("musicPlaylistEntityActionMetadata");var kOj=new g.mV("musicTrackEntityActionMetadata");var V9o=new g.mV("localImageEntityActionMetadata");var aF=new g.mV("playbackDataActionMetadata");var mHh=new g.mV("transferEntityActionMetadata");var Ke7=new g.mV("videoPlaybackPositionEntityActionMetadata");var VA8;new g.CM;new g.CM;nX7.prototype.request=function(B,A,x){A=A===void 0?{}:A;return this.locks.request(B,A,function(w){return x(w)})};var xf=g.lg.caches,A_,hvo;BV.prototype.open=function(B){return xf.open(qJc(B))};
BV.prototype.has=function(B){return xf.has(qJc(B))};
BV.prototype.delete=function(B){return xf.delete(qJc(B))};
BV.prototype.match=function(B,A){var x=this,w,c,V,Z,R,Y;return g.u(function(n){switch(n.N){case 1:return g.y(n,x.keys(),2);case 2:w=n.U,c=g.W(w),V=c.next();case 3:if(V.done){n.t$(5);break}Z=V.value;return g.y(n,x.open(Z),6);case 6:return R=n.U,g.y(n,R.match(B,A),7);case 7:if(Y=n.U)return n.return(Y);V=c.next();n.t$(3);break;case 5:return n.return()}})};
g.Q(dzo,BV);dzo.prototype.keys=function(){var B,A,x,w,c,V,Z,R,Y;return g.u(function(n){if(n.N==1)return B=[],A=g.RI("CacheStorage keys"),g.y(n,xf.keys(),2);x=n.U;w=g.W(x);for(c=w.next();!c.done;c=w.next()){V=c.value;var r=V.indexOf(":");Z=r===-1?{Db:V}:{Db:V.substring(0,r),datasyncId:V.substring(r+1)};R=Z.Db;Y=Z.datasyncId;Y===A&&B.push(R)}return n.return(B)})};g.Q(cV,g.l);cV.prototype.S=function(B){this.api.m7("onOfflineOperationFailure",B.data)};
cV.prototype.D=function(B){this.api.publish("offlinetransferpause",B.data)};
cV.prototype.vR=function(){var B;(B=this.N)==null||B.close();var A;(A=this.U)==null||A.close()};$zc.prototype.rP=function(){this.N&&Z8(this)};
$zc.prototype.Id=function(){this.U&&this.U.resolve();this.S=this.N=!1;this.Z()};var wUW=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var gX0="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var XG0="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.Q(Qd8,ur);Qd8.prototype.U=function(B){return nB(B)?Weh(this,B):r7(B)?NQo(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.Q(jdV,ur);jdV.prototype.U=function(B){return r7(B)?kir(this,B):CHh(B)?CtY(this,B):d7(B)?pNr(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.S=EpW.prototype;g.S.c5R=function(B){var A=this,x,w,c,V;return g.u(function(Z){if(!g.X(B.state,128))return Z.t$(0);x=B.state.Zi;var R=(w=x)==null?void 0:w.errorCode,Y=(c=x)==null?void 0:c.WW;V=R==="net.connect"&&Y===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(R==null?0:R.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.y(Z,A.EV(A.player.getVideoData().videoId,V),0)})};
g.S.EV=function(B,A){var x=this;return g.u(function(w){if(w.N==1){if(x.U)return w.return();x.U=!0;return A==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(MN(x,B,!1,!0),w.t$(0)):g.y(w,g7(x,B),3)}g.HD(B,4);return g.y(w,x.N.EV(A),0)})};
g.S.Vs=function(B){B.status===2?(B.status!==this.S&&(kd0(this.N),g.HD(B.videoId,2)),B.Xj&&y3o(this.N,B.videoId,B.Xj)):B.status===4?(g7(this,B.videoId),this.EV(B.videoId,B.K2?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):B.status===1&&EOh(this.N);this.S=B.status;this.api.m7("localmediachange",{videoId:B.videoId,status:B.status})};
g.S.Fp=function(){var B=this,A;return g.u(function(x){if(x.N==1){if(B.U)return x.return();B.U=!0;A=B.player.getVideoData().videoId;return g.y(x,g7(B,A),2)}return g.y(x,B.N.Fp(),0)})};
g.S.Zq=function(B){switch(B){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.S.B=function(B){return this.api.C().B(B)};g.Q(FeV,ur);FeV.prototype.U=function(B){return nB(B)?Mnh(this,B):r7(B)?ld4(this,B):CHh(B)?TQW(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};JPW.prototype.N=function(B,A){var x=B.action.actionMetadata.priority-A.action.actionMetadata.priority;x===0&&(B.N<A.N?x=-1:B.N>A.N&&(x=1));return x};g.Q(lr,g.l);lr.prototype.vR=function(){this.Z&&this.Z();g.l.prototype.vR.call(this)};
lr.prototype.createAction=function(B,A){var x=g.IY(B.entityKey).entityType,w=g.FP(16);return new IF(x,w,B,A.actionId,A.rootActionId)};
lr.prototype.Et=function(B){var A=this,x,w,c,V,Z,R,Y,n,r;return g.u(function(d){if(d.N==1){if(A.aS())return d.return();w=(x=B.offlineOrchestrationActionWrapperEntity)!=null?x:new Set;c=[];V=g.W(w);for(Z=V.next();!Z.done;Z=V.next())R=Z.value,Y=g.IY(R),n=Y.entityId,zP0(A.N,n)||c.push(R);return g.y(d,Z6Y(A,c),2)}r=d.U;return g.y(d,Vvr(A,r),0)})};
lr.prototype.retry=function(){var B=this;return g.u(function(A){return g.y(A,Ss_(B),0)})};YsW.prototype.LW=function(B,A){A=A===void 0?!0:A;var x=this,w,c,V,Z,R,Y,n,r;return g.u(function(d){switch(d.N){case 1:if(!x.N)return d.return();w=[];c=g.Qs(x.N.U,A);V=[];for(Z={BD:0};Z.BD<c.length;Z={BD:Z.BD},Z.BD++)R=c[Z.BD],Y=x.N.Rr(R,"json3"),n=g.bf(Y,{withCredentials:!0,format:"RAW"},3,500).then(function(q){return function(f){f={metadata:g.hs(c[q.BD]),trackData:f.xhr.responseText};V.push(f)}}(Z)).yZ(function(q){w7("Caption fetch error",q)}),w.push(n);
return g.y(d,ux7(w),2);case 2:return g.Pp(d,3),g.y(d,sbo(B,V),5);case 5:g.Nc(d,0);break;case 3:r=g.j_(d),w7("Caption DB transaction error",r),g.Wp(d)}})};g.Q(Tl,g.l);Tl.prototype.vR=function(){this.U&&this.U();g.l.prototype.vR.call(this)};
Tl.prototype.S=function(B){var A=this,x,w,c,V,Z,R,Y,n;return g.u(function(r){w=(x=B.transfer)!=null?x:new Set;c=[];V=g.W(w);for(Z=V.next();!Z.done;Z=V.next())R=Z.value,Y=g.IY(R),n=Y.entityId,c.push(n);return c.length===0?r.return():g.y(r,dEc(A,c),0)})};g.Q(IDh,g.l);g.S=IDh.prototype;g.S.vR=function(){this.qZ&&this.qZ();this.XR.dispose();this.D.dispose();this.J$&&g.iF(this.Y.YK,this.J$);this.PR&&g.iF(this.Y.YK,this.PR);g.l.prototype.vR.call(this)};
g.S.Xlt=function(B){var A=this,x,w,c;return g.u(function(V){switch(V.N){case 1:x=g.$9(B,"transfer");if(A.N&&x===A.N.key){MN(A.T,A.K,!0);A.D.stop();V.t$(0);break}return g.y(V,zI(A.U,{mode:"readwrite",Yb:!0},function(Z){return Lu(Z,x,"transfer").then(function(R){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!=="TRANSFER_STATE_FAILED")return R.transferState="TRANSFER_STATE_PAUSED_BY_USER",oO(Z,R,"transfer").then(function(){return R})})}),3);
case 3:w=V.U;if(!w){V.t$(0);break}if(!B||!A.S){V.t$(5);break}return g.y(V,qN(B,A.S,A.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.y(V,t_(A,B),7);case 7:c=V.U,kEo({videoId:B,v7:w,offlineModeType:c}),g.Wp(V)}})};
g.S.uSF=function(){var B=this;if(this.N&&this.K){MN(this.T,this.K,!1);var A=this.N,x=(A==null?0:A.key)?g.IY(A.key).entityId:"";x&&this.S&&(new Promise(function(w,c){qN(x,B.S,B.U,"DOWNLOAD_STATE_PAUSED").catch(function(V){c(V)})})).catch(function(w){w7("Download state setting error",w)})}this.D.stop()};
g.S.Hx=function(){this.N?Pd_(this,this.N):LB(this)};
g.S.Lj=function(B){var A=this;return g.u(function(x){switch(x.N){case 1:if(!A.N){x.t$(2);break}if(A.N.transferState==="TRANSFER_STATE_COMPLETE"||A.N.transferState==="TRANSFER_STATE_FAILED"||!B.transfer||!B.transfer.has(A.N.key)){x.t$(3);break}return g.y(x,GI(A.U,A.N.key,"transfer"),4);case 4:A.N=x.U;if(A.N){x.t$(3);break}return g.y(x,UEr(A),3);case 3:if(A.N)return x.return();case 2:return g.y(x,LB(A),0)}})};
g.S.EV=function(B,A){var x=this,w,c,V,Z,R;return g.u(function(Y){switch(Y.N){case 1:if(!x.N){br(x,"onTransferFailure: "+B);Y.t$(2);break}w=x.N;V=((c=w)==null?0:c.key)?g.IY(w.key).entityId:"";a:switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var n=!1;break a;default:n=!0}return n&&H6r(x)?g.y(Y,oF(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.y(Y,
ubo(x,B),5);case 5:if(!V||!x.S){Y.t$(2);break}return g.y(Y,qN(V,x.S,x.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.y(Y,t_(x,V),9);case 9:Z=Y.U;RF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:V,v7:w,offlineModeType:Z});if(!V||!x.S){Y.t$(2);break}return g.y(Y,qN(V,x.S,x.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:m$(x),R=LB(x,!0),A&&A(R),g.Wp(Y)}})};
g.S.Fp=function(B){var A=this,x,w,c,V,Z,R,Y,n,r,d,q,f;return g.u(function(h){switch(h.N){case 1:if(!A.N){br(A,"onMaybeTransferStreamsExpired");h.t$(2);break}return H6r(A)?g.y(h,oF(A,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.y(h,ubo(A,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!A.S){h.t$(2);break}x=A.N;c=((w=x)==null?0:w.key)?g.IY(x.key).entityId:"";if(!c){h.t$(2);break}return g.y(h,qN(c,A.S,A.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return A.N||br(A,"onMaybeTransferStreamsExpiredRetryAttempting"),
V=A.N,R=((Z=V)==null?0:Z.key)?g.IY(V.key).entityId:"",g.y(h,t_(A,R),10);case 10:return Y=h.U,RF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:R,v7:V,offlineModeType:Y}),n=HVV(),g.sh(n,aF,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r=g.$9(R,"playbackData"),d={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:r,actionMetadata:n},q=WV(new IF("playbackData",R,d)),g.y(h,io(A.U,q,"offlineOrchestrationActionWrapperEntity"),2);case 2:m$(A),f=LB(A,!0),
B&&B(f),g.Wp(h)}})};
var FP_={},eIr=(FP_.TRANSFER_STATE_TRANSFERRING=1,FP_.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,FP_);g.S=J_.prototype;g.S.qF=function(){return this.K.promise};
g.S.hY=function(){if(this.U&&this.T)return this.K.promise;F34(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.S.XQ=function(B){var A={};return A.playbackData=new Qd8(B,this.NZ,this.N),A.transfer=new FeV(B,this.NZ),A.videoPlaybackPositionEntity=new jdV(B,this.NZ),A};
g.S.Nl=function(){var B=this;return g.u(function(A){return B.U?g.y(A,$Er(B.U),0):A.t$(0)})};
g.S.mD=function(){var B=this,A,x;return g.u(function(w){if(w.N==1)return B.U||B.T?g.y(w,B.qF(),2):w.return();B.j!==void 0&&(g.ez(B.j),B.j=void 0);B.D!==void 0&&(g.ez(B.D),B.D=void 0);(A=B.U)==null||A.dispose();B.U=void 0;(x=B.T)==null||x.dispose();B.T=void 0;B.api.m7("onOrchestrationLostLeader");B.K=new g.CM;g.Wp(w)})};
g.S.isOrchestrationLeader=function(){return this.S.N};
g.S.hT=function(){return g.u(function(B){return B.return(!1)})};
g.S.f4=function(B){var A=this.N;A.api.publish("offlinetransferpause",B);var x;(x=A.U)==null||x.postMessage(B)};
g.S.Hx=function(B){var A,x;return g.u(function(w){if(w.N==1)return g.y(w,DQ(),2);A=w.U;if(!A)return w.return();x=g.$9(B,"transfer");return g.y(w,zI(A,{mode:"readwrite",Yb:!0},function(c){var V=Lu(c,x,"transfer"),Z=Lu(c,g.$9(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.M5.all([V,Z]).then(function(R){R=g.W(R);var Y=R.next().value;var n=R.next().value;return Y&&Y.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(Y.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",oO(c,Y,"transfer").then(function(){RF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:B,v7:Y,offlineModeType:n==null?void 0:n.offlineModeType});return g.M5.resolve(null)})):g.M5.resolve(null)})}),0)})};
g.S.Gx=function(B){B=B===void 0?43200:B;var A=this,x,w,c,V,Z,R,Y,n;return g.u(function(r){if(r.N==1)return A.Y.PS()?g.y(r,DQ(),2):r.return(gO7());if(r.N!=3){x=r.U;if(!x)return r.return([]);w=Date.now()/1E3;return g.y(r,sc(x,"offlineVideoPolicy"),3)}c=r.U;V=[];Z=g.W(c);for(R=Z.next();!R.done;R=Z.next())Y=R.value,Number(Y.lastUpdatedTimestampSeconds)+B<=w&&(n=g.IY(Y.key).entityId,V.push(n));return V.length?r.return(vV(A,V,A.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):r.return([])})};
g.S.deleteAll=function(){return vV(this,["!*$_ALL_ENTITIES_!*$"],this.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.S.refreshAllStaleEntities=function(B){var A=this;return g.u(function(x){return x.N==1?g.y(x,A.Gx(B),2):x.return(x.U)})};
g.S.setUpPositionSyncInterval=function(B){var A=this;this.D!==void 0&&(g.ez(this.D),this.D=void 0);var x=B!=null?B:864E5;this.D=g.H2(function(){A.wE(x)},x)};
g.S.wE=function(B){var A=this,x,w,c,V,Z,R;return g.u(function(Y){switch(Y.N){case 1:return g.Pp(Y,2),g.y(Y,lo.getInstance(),4);case 4:x=Y.U;if(!x)throw Error("prefStorage is undefined");return g.y(Y,x.get("psi"),5);case 5:w=Y.U;V=((c=w)==null?0:c.Bm)?Number(w.Bm)/1E3:0;Z=Date.now();if(!(V+B<=Z)){Y.t$(6);break}return g.y(Y,vV(A,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Nc(Y,0);break;case 2:R=g.j_(Y),w7("Offline manager error",R),
g.Wp(Y)}})};
g.S.lT=function(){var B=this,A,x,w,c,V,Z,R;return g.u(function(Y){if(Y.N==1)return g.y(Y,DQ(),2);if(Y.N!=3)return(A=Y.U)?g.y(Y,sc(A,"transfer"),3):Y.return([]);x=Y.U;w=[];c=g.W(x);for(V=c.next();!V.done;V=c.next())Z=V.value,Z.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&Z.key&&(R=g.IY(Z.key).entityId,w.push(R));return Y.return(lDV(B,w))})};
g.S.HI=function(){return g.u(function(B){return B.return([])})};
g.S.xg=function(){return g.u(function(B){g.Wp(B)})};
g.S.E9=function(){return g.u(function(B){g.Wp(B)})};g.Q(TXW,ur);TXW.prototype.U=function(B){return nB(B)?tvo(this,B):r7(B)?oOV(this,B):d7(B)?J3o(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var XO=[10];g.Q(Gd_,ur);Gd_.prototype.U=function(B){return nB(B)?BN4(this,B):r7(B)?Af8(this,B):d7(B)?xY4(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var DEV=[10];g.Q(cf7,ur);cf7.prototype.U=function(B){return r7(B)?ZxY(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.Q(S5c,J_);g.S=S5c.prototype;g.S.XQ=function(B){var A=J_.prototype.XQ.call(this,B);A.mainVideoEntity=new Gd_(B,this.NZ,this.N);A.mainPlaylistEntity=new TXW(B,this.NZ,this.N);A.mainDownloadsListEntity=new cf7(B,this.NZ,this.N);return A};
g.S.refreshAllStaleEntities=function(B,A){var x=this,w,c,V,Z,R,Y,n,r,d,q,f;return g.u(function(h){switch(h.N){case 1:w=[];if(!x.NZ.B("web_player_offline_playlist_auto_refresh")){h.t$(2);break}return g.y(h,R5Y(x,B,A),3);case 3:w=h.U;case 2:return g.y(h,lo.getInstance(),4);case 4:return c=h.U,g.y(h,(V=c)==null?void 0:V.get("sdois"),5);case 5:return Z=h.U,g.y(h,(R=c)==null?void 0:R.get("lmqf"),6);case 6:Y=h.U;if(!Z){h.t$(7);break}r=w;d=r.concat;return g.y(h,Y5_(x,Z,(n=Y)!=null?n:"SD",B===0),8);case 8:w=
d.call(r,h.U);case 7:return q=w,f=q.concat,g.y(h,J_.prototype.refreshAllStaleEntities.call(x,B,A),9);case 9:return w=f.call(q,h.U),h.return(w)}})};
g.S.hT=function(B){var A,x,w,c,V,Z,R,Y;return g.u(function(n){if(n.N==1)return g.y(n,DQ(),2);if(n.N!=3)return(A=n.U)?g.y(n,GI(A,g.OU,"mainDownloadsListEntity"),3):n.return(!1);x=n.U;if((w=x)==null?0:(c=w.downloads)==null?0:c.length)for(V=g.$9(B,"mainVideoEntity"),Z=g.W(x.downloads),R=Z.next();!R.done;R=Z.next())if(Y=R.value,Y.videoItem===V)return n.return(!0);return n.return(!1)})};
g.S.HI=function(){var B=this,A,x,w,c,V,Z,R,Y;return g.u(function(n){if(n.N==1)return g.y(n,DQ(),2);if(n.N!=3)return(A=n.U)?g.y(n,sc(A,"downloadStatusEntity"),3):n.return([]);x=n.U;w=[];c=g.W(x);for(V=c.next();!V.done;V=c.next())Z=V.value,Z.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&Z.key&&(R=g.IY(Z.key).entityId,w.push(R));return w.length?(Y={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},n.return(vV(B,w,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Y))):n.return([])})};
g.S.E9=function(){var B;return g.u(function(A){return A.N==1?g.y(A,DQ(),2):(B=A.U)?g.y(A,zI(B,{mode:"readwrite",Yb:!0},function(x){return tT(x,"mainVideoEntity").then(function(w){var c=[];w=g.W(w);for(var V=w.next();!V.done;V=w.next()){V=V.value;var Z=void 0;(Z=V.userState)!=null&&Z.playbackPosition||(Z=g.IY(V.key).entityId,Z={key:g.$9(Z,"videoPlaybackPositionEntity"),videoId:Z,lastPlaybackPositionSeconds:"0"},c.push(oO(x,Z,"videoPlaybackPositionEntity")),V.userState={playbackPosition:Z.key},c.push(oO(x,
V,"mainVideoEntity")))}return g.M5.all(c)})}),0):A.return()})};
g.S.xg=function(){var B,A,x,w,c,V,Z,R,Y,n,r,d,q,f,h,P,N,K,p,H,O,M,t,v,cp,S_,Bp,L,z,I,b,Dx,Nj,Ao,pD,ig,wo,I7;return g.u(function(k){if(k.N==1)return g.y(k,DQ(),2);if(k.N!=3){B=k.U;if(!B)return k.return();A=g.$9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.y(k,zI(B,{mode:"readonly",Yb:!0},function(C){return g.M5.all([Lu(C,A,"mainDownloadsListEntity"),Lu(C,g.OU,"mainDownloadsListEntity"),tT(C,"mainVideoEntity"),tT(C,"mainPlaylistEntity")])}),3)}x=k.U;
w=g.W(x);c=w.next().value;V=w.next().value;Z=w.next().value;R=w.next().value;Y=c;n=V;r=Z;d=R;q=new Set;if((f=Y)==null?0:(h=f.downloads)==null?0:h.length)for(P=g.W(Y.downloads),N=P.next();!N.done;N=P.next())K=N.value,p=void 0,(H=(p=K.videoItem)!=null?p:K.playlistItem)&&q.add(H);if((O=n)==null?0:(M=O.downloads)==null?0:M.length)for(t=g.W(n.downloads),v=t.next();!v.done;v=t.next())cp=v.value,cp.videoItem&&q.add(cp.videoItem);S_=new Set;Bp=[];L=g.W(d);for(z=L.next();!z.done;z=L.next()){I=z.value;if(I.videos)for(b=
g.W(I.videos),Dx=b.next();!Dx.done;Dx=b.next())Nj=Dx.value,(Ao=JSON.parse(g.IY(Nj).entityId).videoId)&&S_.add(Ao);I.key&&!q.has(I.key)&&Bp.push(I.key)}pD=g.W(r);for(ig=pD.next();!ig.done;ig=pD.next())wo=ig.value,wo.key&&!q.has(wo.key)&&(I7=g.IY(wo.key).entityId,S_.has(I7)||Bp.push(wo.key));return Bp.length?g.y(k,bVj(B,Bp),0):k.t$(0)})};g.Q(nwo,ur);nwo.prototype.U=function(B){return nB(B)?dYW(this,B):r7(B)?q5h(this,B):d7(B)?fKj(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var ir=[10];g.Q(Qhr,ur);Qhr.prototype.U=function(B){return nB(B)?$YY(this,B):r7(B)?WP7(this,B):d7(B)?Pu7(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var Gl=[10];g.Q(jhW,ur);jhW.prototype.U=function(B){return nB(B)?plj(this,B):r7(B)?Ew4(this,B):d7(B)?yfr(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var Cur=[10];g.Q(sR,J_);sR.prototype.XQ=function(B){var A=J_.prototype.XQ.call(this,B);A.musicTrack=new jhW(B,this.N);A.musicPlaylist=new Qhr(B,this.N);A.musicAlbumRelease=new nwo(B,this.N);return A};
sR.prototype.refreshAllStaleEntities=function(B,A){var x=this,w,c,V;return g.u(function(Z){if(Z.N==1)return g.y(Z,uVo(x,B,A),2);if(Z.N!=3)return c=w=Z.U,V=c.concat,g.y(Z,J_.prototype.refreshAllStaleEntities.call(x,B,A),3);w=V.call(c,Z.U);return Z.return(w)})};g.Q(e57,g.Ey);g.S=e57.prototype;g.S.create=function(){var B=this;g.T(this,this.events);g.Gx(this.NZ)?this.N=new S5c(this.NZ,this.player):g.zW(this.NZ)&&(this.N=new sR(this.NZ,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){B.J8()});
this.events.G(this.player,"videodatachange",function(){B.J8()});
this.NZ.B("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.Ga)};
g.S.D1=function(){return!1};
g.S.pA=function(B,A,x,w){var c=this;return g.u(function(V){return c.N?V.return(vV(c.N,B,A,x,w)):V.return(Promise.reject())})};
g.S.deleteAll=function(){return this.N.deleteAll()};
g.S.Gx=function(B){return this.N.Gx(B)};
g.S.refreshAllStaleEntities=function(B){return this.N.refreshAllStaleEntities(B)};
g.S.setUpPositionSyncInterval=function(B){this.N.setUpPositionSyncInterval(B)};
g.S.f4=function(B){this.N.f4(B)};
g.S.Hx=function(B){return this.N.Hx(B)};
g.S.J8=function(){var B=this,A;return g.u(function(x){A=B.player.getVideoData();return g.GK(A)?Ox4(A)&&B.U!==A.clientPlaybackNonce?g.y(x,aK0(B,A),0):x.t$(0):x.return()})};
g.S.Ga=function(B){var A=this,x,w,c,V,Z,R,Y;return g.u(function(n){if(n.N==1)return x=A.player.getVideoData(),w=x.Vr,g.Cc(B,2)||g.Cc(B,512)?g.y(n,DQ(),2):n.return();if(n.N!=3){c=n.U;if(!c)return w7("PES is undefined"),n.return();V=x.videoId;return g.y(n,GI(c,g.$9(V,"mainVideoEntity"),"mainVideoEntity"),3)}Z=n.U;if(!Z)return n.return();R=Math.floor(w).toString();Y={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:R}};return g.y(n,A.pA([V],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
Y),0)})};
g.S.isOrchestrationLeader=function(){return this.N.isOrchestrationLeader()};
g.S.updateDownloadState=function(B,A){var x,w,c,V;return g.u(function(Z){if(Z.N==1)return g.y(Z,DQ(),2);x=Z.U;if(!x)return w7("PES is undefined"),Z.return();w=g.IY(B);c=w.entityType;V=w.entityId;return g.y(Z,qN(V,c,x,A,!0),0)})};g.pC("offline",e57);})(_yt_player);
